<html>
<head>
	<meta charset="UTF-8"> 
	<style>body,p,div,span,ul,ol{padding:0;margin:0}html,body{background-color:#444;color:white;width:100%;height:100%;overflow:auto}#load{width:90%;margin-left:0}#dropzone{display:block;width:100%;margin:24pt;padding:48pt 0 48pt 0;border:2pt solid silver;border-radius:16pt;background:transparent;text-align:center;font-size:xx-large;cursor:pointer}#dropzone.drag{border:4pt solid silver}#log{visibility:hidden}#help{width:100%;margin:24pt}#help p{margin-bottom:8pt}#logpath{font-family:courier}#matches{width:100%;margin:24pt}#matches a{color:white}#matches li{display:block;width:auto;list-style-type:none;padding:8pt;border:1pt solid silver;border-radius:8pt;margin-bottom:8pt}#matches .match-duration{margin:8pt}#matches .participant{padding:8pt}#main{width:100%;height:100%;display:flex;flex-direction:column}#main .lower{flex:1 1 auto;display:flex;flex-direction:row;overflow:hidden}#players{flex:0 1 auto;width:100%;clear:both;border-collapse:collapse;border:0 none black;color:gold;border:2pt solid gold}#players .info{width:25%;text-align:center;border-bottom:2pt solid gold;border:2pt solid gold}#players .info *{text-decoration:none;color:white}#players .info[data-quit]{text-decoration:white line-through}#players .mark-prestige,#players .mark-rot,#players .mark-stones,#players .mark-bounty1,#players .mark-bounty2,#players .mark-bounty3{display:none;font:larger "Armello Icons";text-decoration:none;cursor:default}#players .info[data-prestige-leader] .mark-prestige{display:inline}#players .info[data-spirit-walker] .mark-stones{display:inline}#players .info[data-rotten] .mark-rot{display:inline}#players .info[data-bounty="1"] .mark-bounty1{display:inline}#players .info[data-bounty="2"] .mark-bounty2{display:inline}#players .info[data-bounty="3"] .mark-bounty3{display:inline}#players .player{width:25%;min-width:200pt;overflow:hidden;border:2pt solid gold;vertical-align:top;text-align:center}#players *[data-clan="Wolf"]{background-color:#3674A3}#players *[data-clan="Rabbit"]{background-color:#9F7714}#players *[data-clan="Bear"]{background-color:#006006}#players *[data-clan="Rat"]{background-color:#9A2D36}#players *[data-clan="Bandit"]{background-color:#333}#players *[data-clan="Dragon"]{background-color:#824098}#players .equipped{width:100%;min-width:170pt;border-collapse:collapse;border:0 none black;margin-top:4pt;color:gold}#players .equipped td{padding:2pt 4pt}#players .equipped td.followers{border-left:1px solid gold}#players .stats{width:100%;min-width:170pt;border-collapse:collapse;color:gold}#players .stats td{text-align:left;padding:3pt 3pt 3pt 6pt}#players .stats td::before{font:larger "Armello Icons"}#players .stats .Fight::before{content:"F"}#players .stats .Body::before{content:"B "}#players .stats .Wits::before{content:"W"}#players .stats .Spirit::before{content:"S"}#players .stats .SpiritStones::before{content:"T"}#players .stats .Prestige::before{content:"P "}#players .stats .Health::before{content:"H "}#players .stats .Gold::before{content:"G "}#players .stats .Magic::before{content:"M "}#players .stats .Rot::before{content:"R "}#players .items,#players .followers{min-width:64pt;text-align:center}#players .hand{border-top:1px solid gold;margin:0 4pt 0 4pt;max-width:270pt}#players .effects{font-style:italic;margin:4pt;max-width:270pt}#turns{flex:0 0 auto;overflow-y:scroll;min-width:200pt;background-color:#666;cursor:default}#turns .event,#turns .event-container{list-style:none;color:gold;border:1px none black}#turns li.event[selected]{background-color:darkblue;color:white}#turns li:hover{color:white;cursor:pointer}#turns li[selected]:hover{cursor:default}#turns .Wolf{background-color:#3674A3}#turns .Rabbit{background-color:#9F7714}#turns .Bear{background-color:#006006}#turns .Rat{background-color:#9A2D36}#turns .Dragon{background-color:#824098}#turns .Bandit{background-color:#333}#turns .King{background-color:#4169E1}#turns .Bane{background-color:#622078}#turns li.event-chat{font-style:italic}#turns li.event-nextRound{text-align:center;font-weight:bold}#turns li.event-nextRound::before{content:"======= "}#turns li.event-nextRound::after{content:" ======="}#turns li.event-startTurn{border-top:2px solid gold;text-align:center}#turns li.event-playerQuit{color:white;background-color:inherit;text-align:center;font-weight:bold}#turns li.event-victory{color:white;background-color:#4169E1;text-align:center;font-weight:bold}#turns li.event-prestigeLeader::before{font:smaller "Armello Icons";content:"P "}#turns li.event-bountyChanged::before{font:smaller "Armello Icons";content:"1 "}#turns li.event-attack::before,li.event-combatEnd::before{font:smaller "Armello Icons";content:"x "}#turns li.event-putPeril::before,li.event-encounterPeril::before,li.event-completePeril::before{font:smaller "Armello Icons";content:"# "}#turns .event-container{padding-left:5pt}#turns .event-container .event{padding-left:4pt;border-left:solid 2pt gold}#turns .event-container .event:first-child,#turns .event-container .event:last-child{margin-left:-4pt;padding-left:0;border-left:none}#turns li.event-combatEnd,#turns li.event-completePeril{position:relative}#turns li.event .roll-tooltip{display:none;background-color:#222;color:#DDD;border:1px solid white;border-radius:8pt;margin-left:8pt;padding:2pt;cursor:default}#turns li.event:hover .roll-tooltip{display:table;position:absolute}#turns li.event[selected] .roll-tooltip,#turns li.event[selected]:hover .roll-tooltip{display:table;position:relative;width:90%}#turns .roll-tooltip .attacker-name{width:50%;text-align:left;font-weight:bold;padding-right:4pt}#turns .roll-tooltip .attacker{width:50%;text-align:left;border-bottom:1px solid white;padding-right:4pt}#turns .roll-tooltip .defender-name{width:50%;text-align:right;font-weight:bold;padding-left:4pt}#turns .roll-tooltip .defender{width:50%;text-align:right;border-bottom:1px solid white;padding-left:4pt}#turns .roll-tooltip .attacker-dice{font:smaller "Armello Icons";width:50%;text-align:right;padding-right:4pt}#turns .roll-tooltip .defender-dice{font:smaller "Armello Icons";width:50%;text-align:left;padding-left:4pt}#turns .roll-tooltip .roll{padding:1pt}#turns .roll-tooltip .roll-Locked{color:white}#turns .roll-tooltip .roll-Burned{color:gold}#turns .roll-tooltip .roll-Rolled{color:silver}#turns .roll-tooltip .roll-Match{background-color:blue}#turns .roll-tooltip .roll-Pierce{background-color:blue}#turns .roll-tooltip .roll-Reflect{background-color:blue}#turns .roll-tooltip .roll-Poison{background-color:green}.mapwrapper{background-color:#444;display:flex;flex:1 1 auto}#maptooltip{visibility:hidden;display:block;position:absolute;z-index:1;background-color:#222;color:#DDD;border-radius:2pt;padding:2pt;user-select:none;-webkit-user-select:none}#maptooltip .stat{font:smaller "Armello Icons";margin:0 2pt 0 4pt}#map{display:block;margin:auto;max-width:100%;max-height:100%}@font-face{font-family:'Armello Icons';src:url('data:application/octet-stream;base64,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') format('woff');font-weight:normal;font-style:normal}</style><noscript>
		<style> 
		#load {display:none;} 
		#main {display:none;} 
		body::before {
			display: block;
			margin: 24pt 5%;
			padding: 8pt;
			width: 90%;
			border: 1px solid white;
			border-radius: 12pt;
			font: 24pt Arial;
			content: "Armello Replay Tool can't work without JavaScript. Please, enable JavaScript and reload the page.";
		}
		</style>
	</noscript>
	<script>function Name(id){return(id in Name.db)?Name.db[id]:id;}
function Hint(id){return(id in Hint.db)?Hint.db[id]:"";}
function PCard(type){return'<span class="card" data-id="'+type+'" title="'+Hint(type)+'">'+Name(type)+'</span>';}
function PDecl(type){return'<span class="declaration" data-id="'+type+'" title="'+Hint(type)+'">'+Name(type)+'</span>';}
function PEnt(type,id){return'<span class="entity" data-id="'+id+'" title="'+Hint(type)+'">'+Name(type)+'</span>';}
Name.db={Bandit01:"Twiss",Bandit02:"Sylas",Bandit03:"Horace",Bandit04:"Scarlet",Bear01:"Sana",Bear02:"Brun",Bear03:"Ghor",Bear04:"Yordana",Rabbit01:"Amber",Rabbit02:"Barnaby",Rabbit03:"Elyssia",Rabbit04:"Hargrave",Rat01:"Mercurio",Rat02:"Zosha",Rat03:"Sargon",Rat04:"Griotte",Wolf01:"Thane",Wolf02:"River",Wolf03:"Magna",Wolf04:"Fang",Dragon01:"Volodar",Dragon02:"Agniya",Dragon03:"Oxana",Dragon04:"Nazar",King:"The King",KingsGuard:"King's Guard",Bane:"Bane",SIG01:"Black Opal",SIG02:"Obsidian",SIG03:"Ruby",SIG04:"Turquoise",SIG05:"Emerald",SIG06:"Pink Topaz",SIG07:"Diamond",SIG08:"Sunstone",SIG09:"Sapphire",SIG10:"Moonstone",SIG11:"Onyx",SIG12:"Celestite",SIG13:"Jade",SIG14:"Quartz",SIG15:"Amethyst",SIG16:"Amber",SIG17:"Tanzanite",SIG18:"Rainbow Quartz",SIG19:"Rubellite",SIG20:"Aquamarine",SIG21:"Serendibite",SIG22:"Cat's Eye",SIG23:"Spinel",SIG24:"Chrysocolla",SIG25:"Taaffeit",SIG26:"Black Opal",SIG27:"Pink Topaz",SIG28:"Amethyst",SIG29:"Celestite",SIG30:"Cinnabar",SIG35:"Sulfur",SIG36:"Basalt",SIG37:"Axinite",SIG38:"Cinnabar",SIG39:"Tremolite",SIG40:"Serpentine",AMU01:"Scratch Amulet",AMU02:"Soak Amulet",AMU03:"Think Amulet",AMU04:"Feel Amulet",AMU05:"Grow Amulet",AMU06:"Watch Amulet",AMU07:"Favour Amulet",AMU08:"Spoil Amulet",AMU09:"Listener Amulet",AMU10:"Dig Amulet",AMU11:"Sprint Amulet",AMU12:"Discipline Amulet",AMU13:"Resist Amulet",AMU14:"Intimidate Amulet",AMU15:"Harmonize Amulet",AMU16:"Decay Amulet",AMU21:"Ruin Amulet",PERMASCOUT:"Scout",None:"Intimidated","0xC121AA76":"Tax Time","0xC121AA77":"Tribute of Spirit","0xC121AA78":"Peace Treaty","0xC121AA79":"Beasts of Bane","0xC121AA7A":"For Royal Eyes Only","0xC121AA7B":"Royal Acquisition","0xC121AA7C":"The Underdog","0xC121AA7D":"Sinister Rituals","0xC121AA7E":"Healthcare","0xC121AA94":"Blood Moon","0xC121AA96":"King's Mercy","0xC121AA97":"Dishonoured Defender","0xC121AA98":"Royal Flush","0xC121AA99":"Dark Liege","0x6313A480":"Rot Inspection","0x6313A481":"Fugitives Unleashed","0x6313A482":"Martial Law","0x6313A483":"Black Death","0xC121AAB3":"Civil Uprising","0xC121AAB4":"Palace Lockdown","0xC121AAB5":"War March","0xC121AAB6":"Fog of War","0xC121AAB7":"Royal Inquisition","0xC121AAB8":"Supreme Court","0xC121AAB9":"Treasury Visit","0xC121AABA":"Desperate Defence","0xC121AABB":"Desertion!","0xC121AABC":"Life Support","0xC121AAD3":"Cursed Kingdom","0xC121AAD4":"Private Security","0xC121AAD5":"Total Famine","0xC121AAD6":"Dark Storms","0xC121AAD7":"Royal Challenge","0xC121AAD8":"Night Maneuvers","0xC121AAD9":"The Toll Bells Sing","0xC121AADA":"Paws of Fate","0xC121AADB":"King's Bounties","0xC121AAF1":"King's Agents","0xC121AAF2":"Darkest Night","0xC121AAF3":"Ripped Reality","0xC121AAF4":"Terror Awakened","0xC121AAF5":"Rotten Choir","0xC121AAF6":"Royal Stimulus","0xC121AAF7":"Rot Rain","0xC121AAF8":"Highway Fees","0xC121AAF9":"Green-Eyed Monsters","0xC121AAFA":"Sovereign City State","0xC121AB10":"Burn After Reading","0xC121AB11":"War Drums",KING01:"Crown of Armello",KING02:"Wyldhide",KING03:"Pride's Edge",PPN001:"Mother's Maze",PPS001:"The Unseen Death",PPW001:"Fool's Fountain",PPE001:"The Tricking Paths",CON01:"Wyld Weed",CON02:"Wyldsap",CON03:"Cub's Blood",CON04:"Throwing Axe",CON05:"Brazenberry Ale",CON06:"Moon Juice",CON07:"Hot Rot Wine",CON08:"Mountain Moss",CON09:"Bubble Tea",CON10:"Poisoned Gift",CON11:"Blackberry Dust",CON12:"Snake Venom",CON13:"Illusion",FOL01:"Alchemist",FOL02:"Apothecary",FOL03:"Warlock",FOL04:"Explorer",FOL05:"Apprentice",FOL06:"Blacksmith",FOL07:"The Stranger",FOL08:"Brilliant Fool",FOL09:"Bard",FOL10:"Poison Taster",FOL11:"Berserker",FOL12:"Squire",FOL13:"Conjurer",FOL14:"Diplomat",FOL15:"Miner",FOL16:"Spy Master",FOL17:"Coin Master",FOL18:"Trader",ITM01:"Helm of Heroes",ITM02:"Hand Cannons",ITM03:"Bane Blade",ITM04:"Royal Shield",ITM05:"Masquerade Mask",ITM06:"Moon Scythe",ITM07:"Bane's Claw",ITM08:"Royal Pardon",ITM09:"Winged Boots",ITM10:"Wyldfyre Staff",ITM11:"Trusty Shield",ITM12:"Shining Steel Sword",ITM13:"Adventurer's Kit",ITM14:"War Hammer",ITM15:"Battle Armour",ITM16:"Battle Axe",ITM17:"Marauder Gauntlets",ITM18:"Heavy Plate Armour",ITM19:"Royal Banner",ITM20:"Ranger's Cloak",ITM21:"War Horn",ITM22:"Lord's Scepter",ITM23:"Hare's Halberd",ITM24:"Spy Glass",ITM25:"Longbow",ITM26:"Sailor's Lantern",ITM27:"Oak Spear",ITM28:"Heavy Flail",ITM29:"Feathered Helm",ITM30:"Chainmail Shirt",ITM31:"Bastard Sword",ITM32:"Raven's Beak Dagger",ITM33:"Wyld Talisman",ITM34:"Mirror Cape",ITM35:"Poppet",ITM36:"Lionheart Breastplate",ITM37:"Leather Armour",ITM38:"Poisoned Dagger",ITM40:"Torch",ITM41:"Tower Shield",ITM42:"Iron Pike",ITM44:"Reliable Short Sword",ITM45:"Hero's Shield",ITM47:"Silver Lance",ITM48:"Reaper's Trident",ITM50:"King's Guard Armour",ITM52:"Mahogany Staff",MAG01:"Haste",MAG02:"Tanglevine",MAG03:"Bloodthirst",MAG04:"Lightning Strike",MAG05:"Immolation",MAG06:"Syphon",MAG07:"Spirit Strike",MAG08:"Malice Rising",MAG09:"Focus",MAG10:"Rite of Wyld",MAG11:"Aflame",MAG12:"Banish",MAG13:"Regeneration",MAG14:"Crystallise",MAG15:"Plague",MAG16:"Wyld's Warning",MAG17:"Dark Influence",MAG18:"The Cleansing Wyld",MAG19:"Wake the Trees",MAG20:"Glamour",MAG21:"Blizzard",MAG22:"Mirror Image",MAG23:"Bark Skin",MAG24:"Feral",MAG25:"Moonbite",MAG26:"Evil Eye",MAG27:"Wyld Born",MAG28:"Cursed Lands",MAG29:"Teleport",MAG30:"Wall of Thorns",MAG31:"Shimmer Shield",MAG32:"Call of the Worm",MAG33:"Divination",MAG34:"Leech",MAG36:"Spirit Seeds",MAG46:"Rotten Fog",TRK01:"Hoodwinked",TRK02:"Slanderous Toads",TRK03:"False Orders",TRK04:"Mercenaries",TRK05:"Merry Thieves",TRK06:"Disguise",TRK07:"Rangers",TRK08:"Saboteur",TRK09:"Reprieve",TRK10:"Spy Network",TRK11:"Grand Heist",TRK12:"Strategist",TRK13:"Patronage & Industry",TRK14:"Crime Lord",TRK15:"Game of Thorns",TRK16:"Incite Revolt",TRK17:"Witch Hunters",TRK18:"Bounty",TRK19:"Cat Burglar",TRK20:"Beheaded",TRK21:"Expendables",TRK22:"Bribery",TRK23:"Plague Bearers",TRK24:"Merchant's Agreement",TRK25:"Allies' Pact",TRK26:"Wandering Circus",TRK27:"Crooks",TRK28:"Vile Official",TRK29:"Agent of Misfortune",TRK30:"Hidden Trap",TRK31:"Pick Pockets",TRK32:"Welcoming Party",TRK33:"Emissary",TRK34:"Armistice",TRK35:"Blood Money",TRK36:"Blackmail",TRK37:"Stone Wards",TRK38:"Betty's Bargain Brews",TRK38PRE:"Awaiting Betty's Bargain Brews",TRK39:"Simeon's Arms",TRK39PRE:"Awaiting Simeon's Arms",TRK40:"Devious Ruse",TRK42:"Sharpshooter",TRK43:"Arson",TRK44:"Roxy's Recruiting",TRK45:"Biff's Black Market",TRK44PRE:"Awaiting Roxy's Recruiting",TRK45PRE:"Awaiting Biff's Black Market",TRK46:"Palisade Walls",BRW01:"Curse of Valour",BRW02:"Ill Fortune",BRW03:"Curse of Eye",BRW04:"Bloodletting",BRW05:"Curse of Skill",ClanCastle:"Clan Grounds",KingsPalace:"The Palace",KingTile:"Throne Room",Plains:"Plains",Forest:"Forest",Swamp:"Swamp",Mountains:"Mountains",StoneCircle:"Stone Circle",Dungeon:"Dungeon",Settlement:"Settlement",};Hint.db={Bandit01:"Pickpocket: Has Evade everywhere except in the Palace. Upon escape, Twiss steals 1 card from her opponent.",Bandit02:"Butcher: For every King's Guard killed, Sylas gains +1 Sword in Battle. Cleared upon death.",Bandit03:"9th Knight: King's Guards will trade tiles with Horace if he moves into their tile, unless he has a Bounty.",Bandit04:"Revolutionary: Scarlet draws a follower card every time she 'rescues' a Terrorized Settlement.",Bear01:"Priestess: When in combat with any corrupted Creature, Sana uses her Spirit as her Fight.",Bear02:"Scarcaster: For every spell cast gain +1 Fight until after Battle or until the end of the next turn.",Bear03:"Guardian: Ending his turn on a Forest makes Ghor immune to the next instance of damage (dawn Health loss from Rot still occurs).",Bear04:"Cauldron Crone: Spells cast to Yordana during her turn are devoured in her cauldron for -1 Magic, granting a Pact Spell at the end of her turn.",Rabbit01:"Tomb Raider: Always have better outcomes when Exploring Dungeons.",Rabbit02:"Tinkerer: Equipping over an Item in your inventory will return that Item to your hand with the cost/gain removed.",Rabbit03:"Architect: Elyssia permanently fortifies settlements she ends her turn on. Fortified settlements grant a bonus defense while in them and cost opponents an extra AP to move into.",Rabbit04:"Cannoneer: After ending his turn on a Plains or Mountain, Hargrave will fire his cannon at any creature entering an adjacent tile. ",Rat01:"Scoundrel: Steal 1 gold from the owner of a Settlement when you claim it.",Rat02:"Shadow: At Night, Zosha gains Stealth everywhere but the Palace.",Rat03:"Veil Gazer: During the draw phase, all cards are face up.",Rat04:"Street Queen: Griotte's Clan Affinity Dice is equal to the number of Trickery Cards played the previous Day.",Wolf01:"Sword Master: Sword cards Burned in Battle Pierce enemy Shields.",Wolf02:"Huntress: When attacking, River shoots her bow for 1 damage before initiating battle. If her target is killed by this ability, River won't move, but still consumes an Action Point.",Wolf03:"Shield Maiden: Shield cards Burned in Battle Reflect damage back at her opponent.",Wolf04:"Berzerker: When attacking, if Fang Slaughters his opponent, Battle ends before they strike back.",Dragon01:"Enthrall: End your turn near a Bane to enthrall it. Enthralled Bane won't attack you, but will immediately attack any other Hero or Guard entering an adjacent tile.",Dragon02:"Concecrate: After Agniya kills a Creature in Battle, she gains the Worm's Blessing, +1 Health at the start of your turn for next 2 turns.",Dragon03:"Flagellant: When attacking another hero, Oxana destroys a random spell card in their hand, locking that symbol into her combat shelf and adding the card's Magic cost to her explode pool.",Dragon04:"Deceiver: At the start of his Turn after drawing Cards, Nazar gains an Illusion consumable card, allowing him to send an illusion of himself to an adjacent tile, this card is discarded at the end of his Turn.",King:"The King",KingsGuard:"King's Guard",Bane:"Bane",SIG01:"Gain Stealth and +1 sword in Settlements.",SIG02:"Gain Scout on all your claimed Settlements.",SIG03:"First rolled Sword in Battle Explodes.",SIG04:"Gain the Evade Ability and +2 Explode Pool.",SIG05:"Gain +2 Shield on Plains in Battle and Perils.",SIG06:"Doubles Income gained from Settlements.",SIG07:"Gain 1 Prestige for each Treasure Equipped and Follower Recruited.",SIG08:"In Battle and Perils, +1 Sun result while you have more than 3 Gold.",SIG09:"Gain Stealth on Mountains, Day and Night.",SIG10:"Gain +2 Magic for any Kill in Battle.",SIG11:"Gain +2 Gold for any Kill in Battle.",SIG12:"Ignore Mountain movement penalty.",SIG13:"Gain +3 Magic if you are in a Forest at Dawn.",SIG14:"-1 Rot if you are in a Stone Circle at Dawn.",SIG15:"Gain +1 Magic for every Spell Card Burned (+2 if it's a Rot Card).",SIG16:"Burning Sun And Moon cards in Battle is always considered a Hit.",SIG17:"+2 Gold when you escape a Peril.",SIG18:"+1 Magic and +1 Gold every dawn.",SIG19:"+3 Fight when you have less than 4 health.",SIG20:"+1 Moon and +1 Explode Pool if you have less than 3 Rot.",SIG21:"Gain +1 Gold and Prestige each time you kill a King's Guard.",SIG22:"Get a 1 Gold discount on first Trickery Card played each turn.",SIG23:"Get a 20% bonus in all Quests.",SIG24:"Grants Scout on Heroes with 3 Health or less.",SIG25:"+1 Shield and +2 Explode Pool in Forests.",SIG26:"Gain Stealth and +1 Sword in Settlements.",SIG27:"Doubles Income gained from Settlements.",SIG28:"Gain +1 Magic for every Spell Card Burned (+2 if it's a Rot Card).",SIG29:"Ignore Mountain movement penalty.",SIG30:"On the loss of any Prestige, add a random 1 Magic Cost Spell Card to your Hand.",SIG35:"Negates Swamp Damage.",SIG36:"On Dungeons, gain Stealth and first rolled Sword in Battles is Poisoned.",SIG37:"On Creature Kill in combat, gain +1 Die in Battles and Perils until the end of your next Turn.",SIG38:"On the loss of any Prestige, add a random 1 Magic Cost Spell Card to your Hand.",SIG39:" +1 Rot. Ending your turn next to a creature makes them gain +1 Rot until the end of their next turn.",SIG40:"On Quest completion, -1 Rot. Gain +3 Magic if Rot is deducted this way.",AMU01:"+1 Fight.",AMU02:"+1 Body.",AMU03:"+1 Wits.",AMU04:"+1 Spirit.",AMU05:"+1 Health every Dusk.",AMU06:"Guaranteed first symbol match on Perils.",AMU07:"Start with 2 Prestige. You cannot go below 2 Prestige.",AMU08:"Start Infected with 2 Rot.",AMU09:"Get +1 star after a multiplayer match.",AMU10:"Gain +3 Gold every time you collect a Spirit Stone.",AMU11:"End your turn with 1 or more unused Action Points to gain +1 Action Point next turn.",AMU12:"+2 Clan Affinity Dice Bonus.",AMU13:"Gain +1 Shield in Battles and Perils.",AMU14:"End your turn next to a creature, they suffer -2 Dice in Battle until end of next turn.",AMU15:"While not Corrupted, in Battles, all Rot Cards in your hand change to Sun symbols.",AMU16:"Heal 2 Health for each Rot gained, and lose 1 Health for each Rot lost.",AMU21:"Upon entering a Settlement, Terrorize it and gain +1 Rot.",PERMASCOUT:"This hero has played the goblins' game.",None:"Suffer -2 Dice in Battle until end of next turn.","0xC121AA76":"Lose 2 gold. If not enough gold, lose 1 prestige.","0xC121AA77":"Lose 2 magic. If not enough magic, lose 1 prestige.","0xC121AA78":"Heroes that attack another hero lose 3 prestige until the next dawn.","0xC121AA79":"3 Banes will spawn at night.","0xC121AA7A":"Any hero currently in a stone circle or dungeon, or who enters one before the next dawn, receives a bounty.","0xC121AA7B":"Steals one randomly equipped item from each hero, if no items are equipped -2 prestige.","0xC121AA7C":"The hero with the lowest prestige gets a random treasure.","0xC121AA7D":"All Banes on the map get +2 Fight and +2 Body until next Dawn.","0xC121AA7E":"Pay 4 gold, if you have less than 4 gold you will become poisoned.","0xC121AA94":"Every hero gains +1 rot.","0xC121AA96":"The King orders the prestige leader to pass around their renown, giving every other hero 1 prestige.","0xC121AA97":"-3 prestige to the prestige leader for their poor performance. King's guards get +2 fight and body.","0xC121AA98":"All heroes discard all cards in their hand.","0xC121AA99":"Summon four banes to the palace at dawn (will not eject current occupants).","0x6313A480":"Any hero with 1 or more Rot loses 1 prestige.","0x6313A481":"Four trickery perils appear in the Kingdom.","0x6313A482":"King's guards immediately move to the nearest settlement and terrorize them. Will not fight any heroes currently on settlements.","0x6313A483":"Plague Perils ravage Armello's settlements. Settlements that already have a peril are spared.","0xC121AAB3":"All settlements become terrorized.","0xC121AAB4":"The King places a bounty on the prestige leader's head and recalls all idle King's guards back to the palace.","0xC121AAB5":"All heroes have bounties put on their heads.","0xC121AAB6":"All heroes are stealthed until dawn, unless revealed by entering combat or failing a peril.","0xC121AAB7":"Infected heroes lose 1 HP. Corrupted heroes lose 3 HP.","0xC121AAB8":"All heroes lose 3 prestige.","0xC121AAB9":"The prestige leader gives up all of their gold. If they had 5 gold or more, they gain 1 prestige, if not they lose 1 prestige.","0xC121AABA":"All palace perils are removed; guards with 1 HP are spawned in their place if the tile was empty.","0xC121AABB":"All guards defending the Palace disappear.","0xC121AABC":"The King and the prestige leader heal for 1 HP.","0xC121AAD3":"The King plays Cursed Lands to all normal perils.","0xC121AAD4":"Plays Mercenaries on all settlements without other perils.","0xC121AAD5":"Lose 2 gold. If not enough gold, lose 2 health.","0xC121AAD6":"The King plays 4 Lightning Strike perils to random tiles.","0xC121AAD7":"Prestige leader is given a Bounty and +4 Gold.","0xC121AAD8":"King's guards attack heroes at night (regardless of whether or not you have a bounty).","0xC121AAD9":"The King loses 2 fight for the rest of the game and a Lightning Strike hits every creature currently inside the palace.","0xC121AADA":"Each hero swaps their current hand with another random hero.","0xC121AADB":"Anyone who gets a bounty until the next morning will start as a Fugitive.","0xC121AAF1":"Plays Agent of Misfortune to all existing perils (-1 health per unmatched symbol during peril).","0xC121AAF2":"Darkest Night","0xC121AAF3":"Random stone circles received a Banish peril.","0xC121AAF4":"All banes gain +1 Fight and +1 AP for the rest of the game.","0xC121AAF5":"Every creature loses 1 Body.","0xC121AAF6":"Until next dawn, King gives 2 gold for every AP not spent.","0xC121AAF7":"At dusk, every hero and guard not in a settlement, in the palace, or in their clan grounds takes -2 health.","0xC121AAF8":"Until next dawn, pay 2 Gold to enter a settlement.","0xC121AAF9":"For every 3 Gold any hero has, that hero gains 1 Gold and loses 1 Prestige.","0xC121AAFA":"One unclaimed settlement gets permanently fortified, gains Mercenaries Peril and Agent of Misfortune is applied.","0xC121AB10":"-2 Prestige from prestige leader. Their hand is discarded, all drawing decks are re-shuffled and the leader gets a new random full hand.","0xC121AB11":"Bounties to all heroes, add 2 King's Guard.",CON01:"Wyld Weed",CON02:"Wyldsap",CON03:"Cub's Blood",CON04:"Throwing Axe",CON05:"Brazenberry Ale",CON06:"Moon Juice",CON07:"Hot Rot Wine",CON08:"Mountain Moss",CON09:"Bubble Tea",CON10:"Poisoned Gift",CON11:"Blackberry Dust",CON12:"Snake Venom",FOL01:"Alchemist",FOL02:"Apothecary",FOL03:"Warlock",FOL04:"Explorer",FOL05:"Apprentice",FOL06:"Blacksmith",FOL07:"The Stranger",FOL08:"Brilliant Fool",FOL09:"Bard",FOL10:"Poison Taster",FOL11:"Berserker",FOL12:"Squire",FOL13:"Conjurer",FOL14:"Diplomat",FOL15:"Miner",FOL16:"Spy Master",FOL17:"Coin Master",FOL18:"Trader",ITM01:"Helm of Heroes",ITM02:"Hand Cannons",ITM03:"Bane Blade",ITM04:"Royal Shield",ITM05:"Masquerade Mask",ITM06:"Moon Scythe",ITM07:"Bane's Claw",ITM08:"Royal Pardon",ITM09:"Winged Boots",ITM10:"Wyldfyre Staff",ITM11:"Trusty Shield",ITM12:"Shining Steel Sword",ITM13:"Adventurer's Kit",ITM14:"War Hammer",ITM15:"Battle Armour",ITM16:"Battle Axe",ITM17:"Marauder Gauntlets",ITM18:"Heavy Plate Armour",ITM19:"Royal Banner",ITM20:"Ranger's Cloak",ITM21:"War Horn",ITM22:"Lord's Scepter",ITM23:"Hare's Halberd",ITM24:"Spy Glass",ITM25:"Longbow",ITM26:"Sailor's Lantern",ITM27:"Oak Spear",ITM28:"Heavy Flail",ITM29:"Feathered Helm",ITM30:"Chainmail Shirt",ITM31:"Bastard Sword",ITM32:"Raven's Beak Dagger",ITM33:"Wyld Talisman",ITM34:"Mirror Cape",ITM35:"Poppet",ITM36:"Lionheart Breastplate",ITM37:"Leather Armour",ITM38:"Poisoned Dagger",ITM40:"Torch",ITM41:"Tower Shield",ITM42:"Iron Pike",ITM44:"Reliable Short Sword",ITM45:"Hero's Shield",ITM47:"Silver Lance",ITM48:"Reaper's Trident",ITM50:"King's Guard Armour",ITM52:"Mahogany Staff",MAG01:"Haste",MAG02:"Tanglevine",MAG03:"Bloodthirst",MAG04:"Lightning Strike",MAG05:"Immolation",MAG06:"Syphon",MAG07:"Spirit Strike",MAG08:"Malice Rising",MAG09:"Focus",MAG10:"Rite of Wyld",MAG11:"Aflame",MAG12:"Banish",MAG13:"Regeneration",MAG14:"Crystallise",MAG15:"Plague",MAG16:"Wyld's Warning",MAG17:"Dark Influence",MAG18:"The Cleansing Wyld",MAG19:"Wake the Trees",MAG20:"Glamour",MAG21:"Blizzard",MAG22:"Mirror Image",MAG23:"Bark Skin",MAG24:"Feral",MAG25:"Moonbite",MAG26:"Evil Eye",MAG27:"Wyld Born",MAG28:"Cursed Lands",MAG29:"Teleport",MAG30:"Wall of Thorns",MAG31:"Shimmer Shield",MAG32:"Call of the Worm",MAG33:"Divination",MAG34:"Leech",MAG36:"Spirit Seeds",MAG46:"Rotten Fog",TRK01:"Hoodwinked",TRK02:"Slanderous Toads",TRK03:"False Orders",TRK04:"Mercenaries",TRK05:"Merry Thieves",TRK06:"Disguise",TRK07:"Rangers",TRK08:"Saboteur",TRK09:"Reprieve",TRK10:"Spy Network",TRK11:"Grand Heist",TRK12:"Strategist",TRK13:"Patronage & Industry",TRK14:"Crime Lord",TRK15:"Game of Thorns",TRK16:"Incite Revolt",TRK17:"Witch Hunters",TRK18:"Bounty",TRK19:"Cat Burglar",TRK20:"Beheaded",TRK21:"Expendables",TRK22:"Bribery",TRK23:"Plague Bearers",TRK24:"Merchant's Agreement",TRK25:"Allies' Pact",TRK26:"Wandering Circus",TRK27:"Crooks",TRK28:"Vile Official",TRK29:"Agent of Misfortune",TRK30:"Hidden Trap",TRK31:"Pick Pockets",TRK32:"Welcoming Party",TRK33:"Emissary",TRK34:"Armistice",TRK35:"Blood Money",TRK36:"Blackmail",TRK37:"Stone Wards",TRK38:"Betty's Bargain Brews",TRK39:"Simeon's Arms",TRK40:"Devious Ruse",TRK42:"Sharpshooter",TRK43:"Arson",TRK46:"Palisade Walls",};</script>
	<script>function Observable()
{Object.defineProperty(this,'_observers',{value:new Array(),enumerable:false,writable:false,configurable:false,});}
Observable.prototype={constructor:Observable,subscribe:function(handler)
{this._observers.push(handler);},unsubscribe:function(handler)
{var index=this._observers.indexOf(handler);if(index>=0)
this._observers.splice(index,1);},notify:function(property,action,value)
{let args=Array.prototype.slice.call(arguments);args.unshift(this);for(var i=0;i<this._observers.length;i++)
try
{this._observers[i].apply(null,args);}
catch(e)
{console.error(this.constructor.name+": handler "+this._observers[i].name+" produced an error:");console.error(e);console.error("Errorneous handler is: "+this._observers[i].toString());}},};function SerializableObservableCollection()
{Observable.call(this);this.items=[];Object.defineProperty(this,'_itemchanged',{value:Observable.prototype.notify.bind(this,'items','change'),enumerable:false,writable:false,configurable:false,});};SerializableObservableCollection.prototype=Object.create(Observable.prototype);SerializableObservableCollection.prototype.constructor=SerializableObservableCollection;SerializableObservableCollection.prototype.addItem=function(item)
{if(item instanceof Observable)
item.subscribe(this._itemchanged);this.items.push(item);this.notify('items','add',item);};SerializableObservableCollection.prototype.addNewItem=function(Class )
{var item=new(Function.prototype.bind.apply(Class,arguments));this.addItem(item);};SerializableObservableCollection.prototype.clearItems=function()
{for(var i=0;i<this.items.length;i++)
if(item instanceof Observable)
this.items[i].unsubscribe(this._itemchanged);this.items.splice(0,this.items.length);this.notify('items','change');};SerializableObservableCollection.prototype.removeItem=function(item)
{var index=this.items.indexOf(item);if(index<0)
throw new Error(this.constructor.name+": Item "+item.toString()+" does not exist in collection "+this.toString());else
{if(item instanceof Observable)
item.unsubscribe(this._itemchanged);this.items.splice(index,1);this.notify('items','remove',item);}};SerializableObservableCollection.prototype.removeItemById=function(key,value,strict)
{for(var i=0;i<this.items.length;i++)
if(this.items[i][key]==value)
{let item=this.items[i];if(item instanceof Observable)
item.unsubscribe(this._itemchanged);this.items.splice(i,1);this.notify('items','remove',item);return;}
if((typeof strict==='undefined')||strict)
throw new Error(this.constructor.name+": There is no item with "+key.toString()+" = "+value.toString());};SerializableObservableCollection.prototype.getItemById=function(key,value,strict)
{for(var i=0;i<this.items.length;i++)
if(this.items[i].hasOwnProperty(key)&&(this.items[i][key]==value))
return this.items[i];if((typeof strict==='undefined')||strict)
throw new Error(this.constructor.name+": There is no item with "+key.toString()+" = "+value);};SerializableObservableCollection.prototype.serializeItems=function()
{return JSON.stringify(this.items);};SerializableObservableCollection.prototype.deserializeItems=function(data,reviver)
{var objectlist=JSON.parse(data);if(!Array.isArray(objectlist))
throw new Error("Invalid data - not an array");for(var i=0;i<this.items.length;i++)
if(this.items[i]instanceof Observable)
this.items[i].unsubscribe(this._itemchanged);this.items.splice(0,this.items.length);for(var i=0;i<objectlist.length;i++)
if(typeof reviver==='function')
{var newitem=reviver(objectlist[i]);if(newitem instanceof Observable)
newitem.subscribe(this._itemchanged);this.items.push(newitem);}
else
this.items.push(objectlist[i]);this.notify('items','change');};SerializableObservableCollection.getSimpleReviver=function(Class )
{return function(obj)
{var newitem=new(Function.prototype.bind.apply(Class,arguments));var keys=Object.keys(newitem);for(var k=0;k<keys.length;k++)
if(newitem.hasOwnProperty(keys[k]))
newitem[keys[k]]=obj[keys[k]];return newitem;};}</script>
	<script>function Entity(id,type,coords)
{Observable.call(this);this.id=id;this.type=type;this.dead=false;this.corrupted=false;if(typeof coords!=='undefined')
this.coords=coords;else
this.coords="-1,-1";Object.defineProperty(this,'u',{get:function(){return Number.parseInt(this.coords.split(',')[0]);},enumerable:false,configurable:false,});Object.defineProperty(this,'v',{get:function(){return Number.parseInt(this.coords.split(',')[1]);},enumerable:false,configurable:false,});this.Fight=0;this.Body=0;this.Rot=0;this.Health=0;this.ActionPoints=0;this.effects=new Array();this.equipment=new Array();}
Entity.prototype=Object.create(Observable.prototype);Entity.prototype.constructor=Entity;Entity.prototype.moveTo=function(coords)
{this.coords=coords;this.notify('coords','change',this.coords);};Entity.prototype.setType=function(type)
{this.type=type;this.notify('type','change',type);};Entity.prototype.kill=function()
{this.dead=true;this.notify('dead','change',this.dead);};Entity.prototype.changeStat=function(stat,newvalue)
{if(this.hasOwnProperty(stat)&&(this[stat]!==newvalue))
{this[stat]=parseInt(newvalue,10);this.notify(stat,'change',this[stat]);}};Entity.prototype.equipCard=function(slot,card)
{this.equipment[slot]=card;this.notify('equipment','add',card);};Entity.prototype.unequipCard=function(slot,card)
{if(this.equipment[slot]==card)
{this.equipment[slot]=undefined;this.notify('equipment','remove',card);}
else
console.warn('Entity '+this.type+'('+this.id+') lost equipped card '+card+' in slot '+slot+' despite having '+this.equipment[slot]+' there.');};Entity.prototype.addEffect=function(effect,no_dupe)
{if(typeof no_dupe==="undefined")
no_dupe=["AMU","SIG"];if(!this.effects.includes(effect)||!no_dupe.some(function(i){return effect.indexOf(i)==0;}))
this.effects.push(effect);this.notify('effects','add',effect);};Entity.prototype.removeEffect=function(effect)
{var index=this.effects.indexOf(effect);if(index>=0)
{this.effects.splice(index,1);this.notify('effects','remove',effect);}
else
console.warn('Entity ',this.type,'(',this.id,') lost effect ',effect,' despite never having gained it.');};Entity.prototype.toggleCorrupted=function()
{this.corrupted=!this.corrupted;this.notify('corrupted','change',this.corrupted);};function Illusion(id,coords,player,original)
{Entity.call(this,id,"Illusion",coords);this.playerid=player;this.original=original;}
Illusion.prototype=Object.create(Entity.prototype);Illusion.prototype.constructor=Illusion;function Hero(id,corner)
{Entity.call(this,id);this.Wits=0;this.Gold=0;this.Spirit=0;this.Magic=0;this.Prestige=0;this.SpiritStones=0;this.followers=new Array();this.playerid=undefined;this.special={Bounty:0};}
Hero.prototype=Object.create(Entity.prototype);Hero.prototype.constructor=Hero;Hero.prototype.equipCard=function(slot,card)
{if(card.slice(0,3)=='FOL')
{this.followers[slot]=card;this.notify('followers','add',card);}
else
Entity.prototype.equipCard.apply(this,arguments);};Hero.prototype.unequipCard=function(slot,card)
{if(card.slice(0,3)=='FOL')
{if(typeof this.followers[slot]!=='undefined')
{this.followers[slot]=undefined;this.notify('followers','remove',card);}
else
console.warn('Hero ',this.type,'(',this.id,') lost follower ',card,' in slot ',slot,' despite having nothing there.');}
else
Entity.prototype.unequipCard.apply(this,arguments);};Hero.prototype.hasBounty=function()
{return this.special.Bounty>0;};Hero.prototype.getBounty=function()
{return this.special.Bounty;};Hero.prototype.updateBounty=function()
{let bounty=this.getBounty();if((bounty>0)&&(bounty<3))
return this.setBounty(bounty+1);};Hero.prototype.setBounty=function(level)
{if(this.equipment.indexOf('ITM08')>=0)
level=0;if(level!==this.special.Bounty)
{this.special.Bounty=level;this.notify('special','change');return{name:"bountyChanged",entity:this.id,value:level};}}
function EntityCollection()
{SerializableObservableCollection.call(this);}
EntityCollection.prototype=Object.create(SerializableObservableCollection.prototype);EntityCollection.prototype.constructor=EntityCollection;EntityCollection.prototype.getLivingEntity=function(key,value,strict)
{for(var i=0;i<this.items.length;i++)
if(!this.items[i].dead&&this.items[i].hasOwnProperty(key)&&(this.items[i][key]==value))
return this.items[i];if((typeof strict==='undefined')||strict)
throw new Error(this.constructor.name+": There is no item with "+key.toString()+" = "+value);};EntityCollection.prototype.deserializeItems=function(data)
{var entitycopier=SerializableObservableCollection.getSimpleReviver(Entity);var illusioncopier=SerializableObservableCollection.getSimpleReviver(Illusion);var herocopier=SerializableObservableCollection.getSimpleReviver(Hero);var reviver=function(obj)
{if(obj.hasOwnProperty('Prestige'))
return herocopier(obj);else if(obj.hasOwnProperty('original'))
return illusioncopier(obj);else
return entitycopier(obj);};SerializableObservableCollection.prototype.deserializeItems.call(this,data,reviver);};</script>
	<script>function MapTile(type,coords,corner)
{Observable.call(this);if(typeof coords!=='undefined')
this.coords=coords;else
this.coords="-1,-1";Object.defineProperty(this,'u',{get:function(){return Number.parseInt(this.coords.split(',')[0]);},enumerable:false,configurable:false,});Object.defineProperty(this,'v',{get:function(){return Number.parseInt(this.coords.split(',')[1]);},enumerable:false,configurable:false,});this.type=type;this.effects=[];if(type=='Settlement')
this.state={terrorized:false,fortified:false,owner:undefined};else
this.state={};this.peril=undefined;this.perilcard=undefined;this.perilowner=undefined;this.perilbuffs=new Array();this.corner=corner;}
MapTile.prototype=Object.create(Observable.prototype);MapTile.prototype.constructor=MapTile;MapTile.prototype.changeType=function(newtype)
{this.type=newtype;this.notify('type','change',this.type);};MapTile.prototype.setPeril=function(peril,card,owner)
{if(typeof this.peril==='undefined')
{this.peril=peril;this.perilcard=card;this.perilowner=owner;this.perilbuffs=[];this.notify('peril','change',this.peril);}
else
console.warn('Entity ',owner,' tried to set a peril (',peril,') to a tile (',this.coords,') that already had a peril (',this.peril,').');};MapTile.prototype.buffPeril=function(buff)
{if(typeof this.peril!=='undefined')
{this.perilbuffs.push(buff);this.notify('perilbuffs','add',buff);}
else
console.warn('Tried to apply a buff ('+buff+') to a tile without peril.');};MapTile.prototype.clearPeril=function()
{if(typeof this.peril!=='undefined')
{var peril=this.perilcard;this.peril=undefined;this.perilcard=undefined;this.perilowner=undefined;this.perilbuffs=[];this.notify('peril','remove',peril);}
else
console.warn('Tried to clear a peril from a tile without peril.');};MapTile.prototype.hasEffect=function(effect)
{return this.effects.indexOf(effect)>=0;};MapTile.prototype.addEffect=function(effect)
{this.effects.push(effect);this.notify('effects','change',this.effects);};MapTile.prototype.removeEffect=function(effect)
{let idx=this.effects.indexOf(effect);if(idx>=0)
{this.effects.splice(idx,1);this.notify('effects','change',this.effects);}};MapTile.prototype.removeEffects=function()
{for(let i=0;i<arguments.length;i++)
{let idx=this.effects.indexOf(arguments[i]);if(idx>=0)
this.effects.splice(idx,1);}
this.notify('effects','change',this.effects);};MapTile.prototype.terrorizeSettlement=function()
{this.state.terrorized=true;this.state.owner=undefined;this.notify('state','change',this.state);};MapTile.prototype.captureSettlement=function(owner)
{this.state.terrorized=false;this.state.owner=owner;this.notify('state','change',this.state);};MapTile.prototype.fortifySettlement=function()
{this.state.fortified=true;this.notify('state','change',this.state);};function MapMarker(type,coords,title,player)
{Observable.call(this);this.type=type;this.coords=(typeof coords!=='undefined')?coords:'-1,-1';Object.defineProperty(this,'u',{get:function(){return Number.parseInt(this.coords.split(',')[0]);},enumerable:false,configurable:false,});Object.defineProperty(this,'v',{get:function(){return Number.parseInt(this.coords.split(',')[1]);},enumerable:false,configurable:false,});this.title=(typeof title!=='undefined')?title:'';this.player=player;}
MapMarker.prototype=Object.create(Observable.prototype);MapMarker.prototype.constructor=MapMarker;MapMarker.prototype.moveTo=function(coords)
{this.coords=coords;this.notify('coords','change',this.coords);};function LevelMap()
{SerializableObservableCollection.call(this);}
LevelMap.prototype=Object.create(SerializableObservableCollection.prototype);LevelMap.prototype.constructor=LevelMap;LevelMap.prototype.deserializeItems=function(data)
{var tilecopier=SerializableObservableCollection.getSimpleReviver(MapTile);SerializableObservableCollection.prototype.deserializeItems.call(this,data,tilecopier);};function MarkerCollection()
{SerializableObservableCollection.call(this);}
MarkerCollection.prototype=Object.create(SerializableObservableCollection.prototype);MarkerCollection.prototype.constructor=MarkerCollection;MarkerCollection.prototype.deserializeItems=function(data)
{var markercopier=SerializableObservableCollection.getSimpleReviver(MapMarker);SerializableObservableCollection.prototype.deserializeItems.call(this,data,markercopier);};</script>
	<script>function Player(id,name,location,steam)
{Observable.call(this);this.id=id;this.location=location;this.hasquit=false;this.name=name;this.steam=steam;this.hand=new Array();this.heroid=undefined;Object.defineProperty(this,'hero',{value:undefined,enumerable:false,writable:true,configurable:false,});this.corner=undefined;this.quests=0;Object.defineProperty(this,'_herochanged',{value:Observable.prototype.notify.bind(this,'hero','change'),enumerable:false,writable:false,configurable:false,});}
Player.prototype=Object.create(Observable.prototype);Player.prototype.constructor=Player;Player.prototype.setHero=function(hero,corner)
{this.heroid=hero.id;this.hero=hero;this.hero.playerid=this.id;this.hero.subscribe(this._herochanged);this.notify('hero','set',hero);if(corner)
{this.corner=corner;this.notify('corner','set',corner);}};Player.prototype.gainCard=function(card)
{this.hand.push(card);this.notify('hand','add',card);};Player.prototype.loseCard=function(card)
{var index=this.hand.indexOf(card);if(index>=0)
{this.hand.splice(index,1);this.notify('hand','remove',card);}
else
console.warn('Player ',this.name,' lost a card ',card,' from their hand they never had.');};Player.prototype.nextQuest=function()
{this.quests++;this.notify('quests','change',this.quests);};Player.prototype.quit=function()
{this.hasquit=true;this.notify('hasquit','change',this.hasquit);};function MatchContext()
{Observable.call(this);this.active=undefined;this.prestige_leader=0;this.round=-1;this.declaration='';this.pacts=new Array();}
MatchContext.prototype=Object.create(Observable.prototype);MatchContext.prototype.constructor=MatchContext;MatchContext.prototype.setPrestigeLeader=function(player)
{this.prestige_leader=player;this.notify('prestige_leader','change',player);};MatchContext.prototype.setDeclaration=function(declaration)
{this.declaration=declaration;this.notify('declaration','change',declaration);};MatchContext.prototype.setTurn=function(entity)
{this.active=entity;this.notify('active','change',entity);};MatchContext.prototype.nextRound=function()
{this.round++;this.notify('round','change',this.round);};MatchContext.prototype.isDay=function(){return this.round%2==0;};MatchContext.prototype.isNight=function(){return this.round%2==1;};MatchContext.prototype.addPact=function(type,initiator,recipient)
{this.pacts.push({type:type,initiator:initiator,recipient:recipient,});this.notify('pacts','add',this.pacts[this.pacts.length-1]);};MatchContext.prototype.breakPactBetween=function(type,p1,p2)
{for(var i=this.pacts.length;i>=0;i--)
if(((this.pacts[i].initiator==p1)&&(this.pacts[i].recipient==p2))||((this.pacts[i].initiator==p2)&&(this.pacts[i].recipient==p1)))
this.pacts.splice(i,1);this.notify('pacts','change');};MatchContext.prototype.clearPactsFor=function(player)
{for(var i=this.pacts.length-1;i>=0;i--)
if((this.pacts[i].initiator==player)||(this.pacts[i].recipient==player))
this.pacts.splice(i,1);this.notify('pacts','change');};MatchContext.prototype.serialize=function()
{return JSON.stringify(this);};MatchContext.prototype.deserialize=function(data)
{var obj=JSON.parse(data);this.round=obj.round;this.notify('round','change',this.round);this.active=obj.active;this.notify('active','change',this.active);this.prestige_leader=obj.prestige_leader;this.notify('prestige_leader','change',this.prestige_leader);this.declaration=obj.declaration;this.notify('declaration','change',this.declaration);this.pacts=obj.pacts;this.notify('pacts','change',this.pacts);};function PlayerCollection()
{SerializableObservableCollection.call(this);}
PlayerCollection.prototype=Object.create(SerializableObservableCollection.prototype);PlayerCollection.prototype.constructor=PlayerCollection;PlayerCollection.prototype.deserializeItems=function(data,entities)
{var basereviver=SerializableObservableCollection.getSimpleReviver(Player);var reviver=function(obj)
{var plr=basereviver(obj);plr.setHero(entities.getItemById('id',obj.heroid),obj.corner);return plr;};SerializableObservableCollection.prototype.deserializeItems.call(this,data,reviver);};</script>
	<script>function MatchState()
{Observable.call(this);this.context=new MatchContext();this.context.subscribe(Observable.prototype.notify.bind(this,'context','change'));this.map=new LevelMap();this.map.subscribe(Observable.prototype.notify.bind(this,'map','change'));this.entities=new EntityCollection();this.entities.subscribe(Observable.prototype.notify.bind(this,'entities','change'));this.markers=new MarkerCollection();this.markers.subscribe(Observable.prototype.notify.bind(this,'markers','change'));this.players=new PlayerCollection();this.players.subscribe(Observable.prototype.notify.bind(this,'players','change'));}
MatchState.prototype=Object.create(Observable.prototype);MatchState.prototype.constructor=MatchState;MatchState.prototype.traders=['TRK38','TRK39','TRK44','TRK45'];MatchState.prototype.traders_pre=['TRK38PRE','TRK39PRE','TRK44PRE','TRK45PRE'];MatchState.prototype.assaultcards=['MAG04','MAG05','MAG07','MAG11','MAG12','MAG25','MAG34','TRK08','CON04','CON07','CON10','CON11',];MatchState.prototype.loadSnapshot=function(data)
{this.context.deserialize(data.context);this.map.deserializeItems(data.map);this.entities.deserializeItems(data.entities);this.markers.deserializeItems(data.markers);this.players.deserializeItems(data.players,this.entities);};MatchState.prototype.getSnapshot=function()
{return{context:this.context.serialize(),map:this.map.serializeItems(),entities:this.entities.serializeItems(),markers:this.markers.serializeItems(),players:this.players.serializeItems(),};};MatchState.prototype.startBounty=function(hero)
{if(!hero.hasBounty())
{if(this.context.declaration==='0xC121AADB')
return hero.setBounty(2);else
return hero.setBounty(1);}};MatchState.prototype.event_handlers={spawnNPC:function(evt){this.entities.addNewItem(Entity,evt.entity,evt.type,evt.coords);},spawnIllusion:function(evt)
{let player=this.players.getItemById('id',evt.player);this.entities.addNewItem(Illusion,evt.entity,evt.coords,evt.player,player.hero.type);},spawnHero:function(evt)
{let hero=new Hero(evt.entity);this.entities.addItem(hero);let player=this.players.getItemById('id',evt.player);let corner;switch(evt.coords)
{case'0,0':corner='Northeast';break;case'7,0':corner='Northwest';break;case'3,8':corner='Southwest';break;case'-4,8':corner='Southeast';break;default:if(evt.corner)corner=evt.corner;break;}
player.setHero(hero,corner);let tile=this.map.getItemById('coords',evt.coords);tile.state.player=evt.player;},setupHero:function(evt)
{let hero=this.entities.getItemById('id',evt.entity);hero.setType(evt.type);hero.moveTo(evt.coords);},moveEntity:function(evt)
{let entity=this.entities.getItemById('id',evt.entity);entity.moveTo(evt.coords);if(entity instanceof Hero)
{let tile=this.map.getItemById('coords',evt.coords);if(tile.type==='KingsPalace')
return this.startBounty(entity);else if(this.context.declaration=='0xC121AA7A'&&(tile.type==='Dungeon'||tile.type==='StoneCircle'))
return this.startBounty(entity);}},attack:function(evt)
{let attacker=this.entities.getItemById('id',evt.attacker);let defender=this.entities.getItemById('id',evt.defender);if((attacker instanceof Hero)&&(defender instanceof Hero)&&(attacker.equipment.indexOf('ITM08')<0)&&this.context.pacts.some(function(p){return(p.type==='TRK34')&&((p.initiator==attacker.playerid&&p.recipient==defender.playerid)||(p.initiator==defender.playerid&&p.recipient==attacker.playerid));}))
{return attacker.setBounty(3);}},combatEnd:function(evt)
{let attacker=this.entities.getItemById('id',evt.attacker);let defender=this.entities.getItemById('id',evt.defender);if((attacker instanceof Hero)&&(attacker.equipment.indexOf('ITM08')<0)&&(evt.outcome!='Attacking-Defeat')&&(evt.outcome!='Attacking-BothDead'))
{if(defender.type==="KingsGuard"&&!attacker.hasBounty())
return this.startBounty(attacker);else if(defender.type==="King"&&(evt.outcome=='Attacking-Lose'))
return attacker.setBounty(3);}},killEntity:function(evt)
{let ent=this.entities.getItemById('id',evt.entity);if(ent instanceof Hero)
{this.context.clearPactsFor(ent.playerid);return ent.setBounty(0);}
else
ent.kill();},applyKingsDecToGuard:function(evt)
{if(this.context.declaration=='0xC121AABB')
this.entities.getItemById('id',evt.entity).kill();},addEffect:function(evt){this.entities.getItemById('id',evt.entity).addEffect(evt.card);},removeEffect:function(evt){this.entities.getItemById('id',evt.entity).removeEffect(evt.card);},equipCard:function(evt)
{let entity=this.entities.getItemById('id',evt.entity);entity.equipCard(parseInt(evt.slot),evt.card);if((entity instanceof Hero)&&(evt.card==='ITM08'))
return entity.setBounty(0);},unequipCard:function(evt){this.entities.getItemById('id',evt.entity).unequipCard(evt.slot,evt.card);},gainCard:function(evt){this.players.getItemById('id',evt.player).gainCard(evt.card);},loseCard:function(evt){this.players.getItemById('id',evt.player).loseCard(evt.card);},changeStats:function(evt)
{let ent=this.entities.getItemById('id',evt.entity);let before=ent[evt.stat];ent.changeStat(evt.stat,evt.value);let after=ent[evt.stat];if((evt.stat=='Rot')&&(ent instanceof Hero)&&((before<5)!=(after<5)))
ent.toggleCorrupted();},gainPact:function(evt)
{let p1=evt.player;let p2=this.entities.getItemById('id',evt.entity).playerid;this.context.addPact(evt.card,p1,p2);},losePact:function(evt){this.context.breakPactBetween(evt.card,evt.player1,evt.player2);},playCardOnCreature:function(evt)
{let hero=this.entities.getItemById('playerid',evt.player);let entity=this.entities.getItemById('id',evt.entity);if(evt.card==='TRK18'&&(entity instanceof Hero))
{let level=entity.getBounty();if(level>0&&level<3)
return entity.setBounty(level+1);else if(level==0)
return this.startBounty(entity);}
else if(evt.card==='TRK09')
return entity.setBounty(0);else if(entity.type==='KingsGuard'&&this.assaultcards.indexOf(evt.card)>=0)
return this.startBounty(hero);},addTile:function(evt)
{if(!this.map.getItemById('coords',evt.coords,false))
this.map.addNewItem(MapTile,evt.type,evt.coords,evt.corner);},addTileEffect:function(evt)
{if(evt.card!='None')
this.map.getItemById('coords',evt.coords).addEffect(evt.card);},playCardOnTile:function(evt)
{let tile=this.map.getItemById('coords',evt.coords);switch(evt.card+'>'+tile.type)
{case'MAG36>Swamp':tile.changeType('Forest');break;case'TRK43>Forest':tile.changeType('Swamp');break;case'TRK46>Settlement':tile.addEffect('TRK46');break;default:{let trdid=this.traders.indexOf(evt.card);if((trdid>=0)&&(tile.type=='Settlement'))
{tile.removeEffect.apply(tile,this.traders);tile.removeEffect.apply(tile,this.traders_pre);tile.addEffect(this.traders_pre[trdid]);}}}},putPeril:function(evt)
{let id=(evt.owner<5)?this.players.getItemById('id',evt.owner).hero.id:evt.owner;this.map.getItemById('coords',evt.coords).setPeril(evt.peril,evt.card,id);},buffPeril:function(evt){this.map.getItemById('peril',evt.peril).buffPeril(evt.card);},clearPeril:function(evt){this.map.getItemById('peril',evt.peril).clearPeril();},settlementChangeOwner:function(evt)
{let tile=this.map.getItemById('coords',evt.coords);let entityid;if((evt.reason==='Entity')||(evt.reason==='BaneTerrorise')||(evt.reason==='KingsGuardTerrorise')||(evt.reason==='HeroClaim'))
{let entity=this.entities.getLivingEntity('coords',evt.coords,false);entityid=entity?entity.id:undefined;}
else if(evt.entity)
entityid=evt.entity;else if(evt.player)
entityid=this.players.getItemById('id',evt.player).heroid;if((evt.type=='SettlementTerrorised')||(evt.reason=='TerroriseSettlement')||(evt.reason=='BaneTerrorise')||(evt.reason=='KingsDec')||(evt.reason=='KingsGuardTerrorise')||(evt.reason=='TRK16'))
{tile.terrorizeSettlement();tile.removeEffects('TRK13','TRK37','TRK44','TRK45','TRK44PRE','TRK45PRE','TRK46');}
else
tile.captureSettlement(entityid);},settlementFortified:function(evt){this.map.getItemById('coords',evt.coords).fortifySettlement();},predictBane:function(evt)
{if(evt.active=='True')
this.markers.addNewItem(MapMarker,'banespawn',evt.coords,'Incoming Bane');else
this.markers.removeItemById('coords',evt.coords);},predictSpiritStone:function(evt)
{if(evt.active=='True')
this.markers.addNewItem(MapMarker,'stonespawn',evt.coords,'Incoming Spirit Stone');else
this.markers.removeItemById('coords',evt.coords);},spawnSpiritStone:function(evt)
{let entity=this.entities.getItemById('coords',evt.coords,false);if(!entity)
this.markers.addNewItem(MapMarker,'stone',evt.coords,'Spirit Stone');},removeSpiritStone:function(evt)
{for(let i=0;i<this.markers.items.length;i++)
if((this.markers.items[i].type=='stone')&&(this.markers.items[i].coords==evt.coords))
{this.markers.removeItem(this.markers.items[i]);break;}},setQuest:function(evt)
{let player=this.players.getItemById('id',evt.player);let quest=this.markers.getItemById('player',evt.player,false);if(quest)
this.markers.removeItem(quest);else
player.nextQuest();this.markers.addNewItem(MapMarker,'quest',evt.coords,Name(player.hero.type)+" quest #"+player.quests,evt.player);},completeQuest:function(evt)
{let hero=this.entities.getItemById('id',this.context.active);if(!(hero instanceof Hero))return;let quest=this.markers.getItemById('player',hero.playerid,false);if(quest&&(hero.coords==quest.coords))
this.markers.removeItem(quest);},prestigeLeader:function(evt){this.context.setPrestigeLeader(evt.player);},declaration:function(evt)
{this.context.setDeclaration(evt.type);switch(this.context.declaration)
{case'0xC121AA7A':{let bounties=[];for(let p=0;p<4;p++)
{let bounty;let hero=this.players.items[p].hero;let tile=this.map.getItemById('coords',hero.coords)
if(tile.type=='Dungeon'||tile.type=='StoneCircle')
bounty=this.startBounty(hero);if(bounty)
bounties.push(bounty);};return bounties;};break;case'0xC121AAD7':case'0xC121AAB4':{let hero=this.entities.getItemById('playerid',this.context.prestige_leader);return this.startBounty(hero);};break;case"0xC121AAB5":case"War Drums":{let bounties=[];for(let p=0;p<4;p++)
{let hero=this.players.items[p].hero;let bounty=this.startBounty(hero);if(bounty)
bounties.push(bounty);}
return bounties;};break;}},playerStart:function(evt)
{if(typeof this.players.getItemById('id',evt.player,false)==='undefined')
this.players.addNewItem(Player,evt.player,evt.alias,evt.loc,evt.steam);},playerQuit:function(evt){this.players.getItemById('id',evt.player).quit();},startTurn:function(evt)
{let entity=evt.entity?evt.entity:this.entities.getItemById('playerid',evt.player).id;this.context.setTurn(entity);},endTurn:function(evt){this.context.setTurn(undefined);},nextRound:function(evt)
{let events=undefined;this.context.nextRound();if(this.context.isDay())
{events=[];for(let p=0;p<4;p++)
{let bounty=this.players.items[p].hero.updateBounty();if(bounty)
events.push(bounty);}
for(let i=0;i<this.map.items.length;i++)
{let item=this.map.items[i];item.removeEffects('MAG30','MAG46');}}
for(let i=0;i<this.map.items.length;i++)
{let item=this.map.items[i];if(item.type=='Settlement')
{item.removeEffects.apply(item,this.traders);for(let j=0;j<this.traders_pre.length;j++)
if(item.hasEffect(this.traders_pre[j]))
{item.removeEffect(this.traders_pre[j]);item.addEffect(this.traders[j]);}}}
return events;},};MatchState.prototype.processEvent=function(evt)
{try
{let handler=this.event_handlers[evt.name];if(handler)
return handler.call(this,evt);}
catch(err)
{console.error("Error when processing event: ",evt);throw err;}};</script>
	<script data-loader="true">function ParserItem(owner,name,re,map,action,log)
{this.name=name;this.owner=owner;this.action=action;this.regexp=re;this.map=map;this.log=log;this.action=(typeof this.action==='function')?action:ParserItem.prototype._noop;}
ParserItem.prototype=Object.create({});ParserItem.prototype.constructor=ParserItem;ParserItem.prototype._noop=function(evt){return evt;};ParserItem.prototype.run=function(line)
{var match;if(match=line.match(this.regexp))
{var evt={};for(var i=0;i<this.map.length;i++)
evt[this.map[i]]=match[i+1];evt.name=this.name;evt=this.action.call(this.owner.data,evt);if(this.log)
{console.log(line);console.log(evt);}
return evt;}
else
return;};function Parser(fields,items,detectfunc)
{this.data_init=fields;this.data=Object.create(fields);this.items=[];for(var i=0;i<items.length;i++)
this.items.push(new ParserItem(this,items[i].name,items[i].re,items[i].map,items[i].action,items[i].log));this.matchFinderFunc=detectfunc.bind(this.data);}
Parser.prototype=Object.create({});Parser.prototype.constructor=Parser;Parser.prototype._parseLine=function(line,pos)
{var events=[];var evt;for(var i=0;i<this.items.length;i++)
{evt=this.items[i].run(line);if(typeof evt!=='undefined')
events.push(evt);}
return events;};Parser.prototype.findMatches=function(file,linecb)
{this.data=Object.create(this.data_init);let matchfinderfunc=this.matchFinderFunc;if(typeof linecb!=='function')
return Parser._scanFile(file,matchfinderfunc);else
return Parser._scanFile(file,function(line,pos)
{linecb(line,pos);return matchfinderfunc(line,pos);});};Parser.prototype.parseFile=function(file,linecb)
{let linefunc=Parser.prototype._parseLine.bind(this);this.data=Object.create(this.data_init);if(typeof linecb!=='function')
return Parser._scanFile(file,linefunc);else
return Parser._scanFile(file,function(line,pos)
{linecb(line,pos);return linefunc(line);});};Parser._versionToArray=function(v)
{return(v+'.0.0.0').split('.').slice(0,4).map(function(x){return parseInt(x,10);});};Parser._versionComparer=function(v1,v2)
{for(let i=0;i<v1.length;i++)
if(v1[i]<v2[i])return-1;else if(v1[i]>v2[i])return 1;return 0;}
Parser._findClosest=function(version)
{var temp=[];var ver=Parser._versionToArray(version);var vs=Object.keys(Parser.Parsers).map(Parser._versionToArray);for(var n=0;n<4;n++)
{temp=vs.filter(function(v){return v[n]==ver[n];}).sort(Parser._versionComparer);if(temp.length==0)
{let greater=vs.filter(function(v){return v[n]>ver[n];}).sort(Parser._versionComparer);if(greater.length>0)
return greater[0].join('.');else
return vs[vs.length-1].join('.');}
else if(temp.length==1)
return temp[0].join('.');else
vs=temp;}
if(temp.length>0)
return temp[0];else
return undefined;};Parser.Parsers={};Parser.provideParserForFile=function(file)
{return new Promise(function(resolve,reject)
{const slicesize=4*1024;var reader=new FileReader();reader.onloadend=function(event)
{var re=/Build\s*ID:[^0-9]+((?:\d+\.)+\d+)-/ig;var version;var match=re.exec(event.target.result);if(match)
{var v=Parser._findClosest(match[1]);if(typeof v==='undefined')
reject("No matching parser found for version "+match[1]+"!");else
resolve(Parser.Parsers[v]);}
else
reject("No version info found!");};reader.readAsText(file.slice(0,slicesize));});};Parser._UTF8size=function(str)
{var s=str.length;for(var i=str.length-1;i>=0;i--)
{var code=str.charCodeAt(i);if(code>0x7f&&code<=0x7ff)s++;else if(code>0x7ff&&code<=0xffff)s+=2;if(code>=0xDC00&&code<=0xDFFF)i--;}
return s;};Parser._scanFile=function(file,linefunc)
{return new Promise(function(resolve,reject)
{const slicesize=64*1024;const sz=file.size;var position=0;var startpos=0;var buffer="";var values=new Array();var reader=new FileReader();reader.onloadend=function(evt)
{if(evt.target.error)
reject(evt.target.error);buffer+=evt.target.result;for(var i=buffer.indexOf("\n");i>=0;i=buffer.indexOf("\n"))
{var line=buffer.slice(0,i+1);buffer=buffer.slice(i+1);try
{let value=linefunc(line,startpos,sz);if(typeof value!=='undefined')
if(Array.isArray(value))
Array.prototype.push.apply(values,value);else
values.push(value);}
catch(err)
{reject(err);return;}
startpos+=Parser._UTF8size(line);}
position+=slicesize;if(position<sz)
reader.readAsText(file.slice(position,position+slicesize));else
{if(buffer.length>0)
try
{let value=linefunc(buffer,startpos,sz);if(typeof value!=='undefined')
values.push(value);}
catch(err)
{reject(err);return;}
resolve(values);}};reader.readAsText(file.slice(0,slicesize));});}</script>
	<script data-loader="true">Parser.Parsers['1.6.1.0']=new Parser({},[],function(line,pos)
{throw new Error("Sorry, but Armello versions below 1.7 are not supported.");});</script>
	<script data-loader="true">Parser.Parsers['1.7.1.0']=new Parser({heroes_completed:[false,false,false,false],attacker:undefined,re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: InGameState/i,re_end:/(\d+:\d+:\d+)\W+Matchmaking: Exiting matchmaking state: InGameState/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: \w+, Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_setuphero:/\[Hero (\w+) \((\d+)\):\s*Player=Player(\d),\s*Pos=\(-?\d+,-?\d+\)\],/i,chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s* \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] \w+#Sync#\d+ SetupPlayerHero \(Player(\d), (\d+), (\w+)\)/i,map:["player","entity","corner"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):\s*Player=Player(\d),\s*Pos=\((-?\d+,-?\d+)\)\],/i,map:["type","entity","player","coords"],action:function(evt)
{var p=Number.parseInt(evt.player)-1;if(!this.heroes_completed[p])
{this.heroes_completed[p]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\w+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\((?:\[.+?\])?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+),\s*Type:\w+\s*\]\)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+),\s*Type:\w+\s*\]\)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\): .+?\((\d+)\), [^\]]*\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player1","entity1","card","entity2"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero .+? \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"losePact",re:/Gameplay: HeroPactManager\+Message\+LosePact: Dispatch\(\[[^(]+ \(\d+\): Player=Player(\d),[^]]*\], \[[^(]+ \(\d+\): Player=Player(\d),[^]]*\]/i,map:["player1","player2"]},{name:"toggleBounty",re:/Gameplay: Bounty\+Message\+BountyActiveChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\): Player=Player(\d+), Pos=\((-?\d+,-?\d+)\)/i,map:["entity","player","coords"]},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[.+?\((\d+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["entity","card","coords"],action:function(evt)
{this.card_on_tile_cache={entity:evt.entity,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+BuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+),\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/\[url=\"kingsdec:\/\/(\w+)\"\]/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/Matchmaking: NetworkRoomSteam: OnRoomPlayerDisconnected: .+ \(Player(\d)\), error (\w+)/i,map:["player","reason"]},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStart: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\): [^(]+ \((\w+)\)/i,map:["player","entity"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\): .+? \((\w+)\)/i,map:["player","entity"],},{name:"victory",re:/Winner: \[Player .+ \(Player(\d)\): [^(]+ \((\w+)\)/i,map:["player","entity"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{var match;var player;if(match=this.re_start.exec(line))
this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[]};else if((match=this.re_player.exec(line))&&(typeof this.matchinfo!=='undefined')&&(this.matchinfo.players.length<4))
this.matchinfo.players.push({name:match[1],steam:match[2]});else if(this.matchinfo&&(match=this.re_setuphero.exec(line))&&(player=this.matchinfo.players[parseInt(match[3])-1])&&(!player.hero))
player.hero=match[1];else if((match=this.re_end.exec(line))&&(typeof this.matchinfo!=='undefined'))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['1.8.2.0']=new Parser({heroes_completed:[false,false,false,false],attacker:undefined,re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: InGameState/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: Exiting matchmaking state: InGameState|Analytics: (?:AnalyticsController: )?OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: \w+, Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_setuphero:/\[Hero (\w+) \((\d+)\):\s*Player=Player(\d),\s*Pos=\(-?\d+,-?\d+\)\],/i,chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s* \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] \w+#Sync#\d+ SetupPlayerHero \(Player(\d), (\d+), (\w+)\)/i,map:["player","entity","corner"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):\s*Player=Player(\d),\s*Pos=\((-?\d+,-?\d+)\)\],/i,map:["type","entity","player","coords"],action:function(evt)
{var p=Number.parseInt(evt.player)-1;if(!this.heroes_completed[p])
{this.heroes_completed[p]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\w+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\((?:\[.+?\])?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+),\s*Type:\w+\s*\]\)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+),\s*Type:\w+\s*\]\)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\): .+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero .+? \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"losePact",re:/Gameplay: HeroPactManager\+Message\+LosePact: Dispatch\(\[[^(]+ \(\d+\): Player=Player(\d),[^]]*\], \[[^(]+ \(\d+\): Player=Player(\d),[^]]*\]/i,map:["player1","player2"]},{name:"toggleBounty",re:/Gameplay: Bounty\+Message\+BountyActiveChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\): Player=Player(\d+), Pos=\((-?\d+,-?\d+)\)/i,map:["entity","player","coords"]},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[.+?\((\d+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["entity","card","coords"],action:function(evt)
{this.card_on_tile_cache={entity:evt.entity,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+),\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/\[url=\"kingsdec:\/\/(\w+)\"\]/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/Matchmaking: NetworkRoomSteam: OnRoomPlayerDisconnected: .+ \(Player(\d)\), error (\w+)/i,map:["player","reason"]},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\): [^(]+ \((\w+)\)/i,map:["player","entity"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\): .+? \((\w+)\)/i,map:["player","entity"],},{name:"victory",re:/Winner: \[Player .+ \(Player(\d)\): [^(]+ \((\w+)\)/i,map:["player","entity"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{var match;var player;if(match=this.re_start.exec(line))
this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[]};else if((match=this.re_player.exec(line))&&(typeof this.matchinfo!=='undefined')&&(this.matchinfo.players.length<4))
this.matchinfo.players.push({name:match[1],steam:match[2]});else if(this.matchinfo&&(match=this.re_setuphero.exec(line))&&(player=this.matchinfo.players[parseInt(match[3])-1])&&(!player.hero))
player.hero=match[1];else if((match=this.re_end.exec(line))&&(typeof this.matchinfo!=='undefined'))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['1.9.6.0']=new Parser({heroes_completed:[false,false,false,false],re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: InGameState/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: Exiting matchmaking state: InGameState|Analytics: (?:AnalyticsController: )?OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: \w+, Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_setuphero:/\[Hero (\w+) \((\d+)\):\s*Player=Player(\d),\s*Pos=\(-?\d+,-?\d+\)\],/i,chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s* \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] \w+#Sync#SetupPlayerHero#\d  \(Processing\) \(Player(\d), (\d+), (\w+)\)/i,map:["player","entity","corner"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):\s*Player=Player(\d),\s*Pos=\((-?\d+,-?\d+)\)\],/i,map:["type","entity","player","coords"],action:function(evt)
{var p=Number.parseInt(evt.player)-1;if(!this.heroes_completed[p])
{this.heroes_completed[p]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\w+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\((?:\[.+?\])?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+),\s*Type:\w+\s*\]\)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+),\s*Type:\w+\s*\]\)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\): .+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero .+? \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"losePact",re:/Gameplay: HeroPactManager\+Message\+LosePact: Dispatch\(\[[^(]+ \(\d+\): Player=Player(\d),[^]]*\], \[[^(]+ \(\d+\): Player=Player(\d),[^]]*\]/i,map:["player1","player2"]},{name:"toggleBounty",re:/Gameplay: Bounty\+Message\+BountyActiveChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\): Player=Player(\d+), Pos=\((-?\d+,-?\d+)\)/i,map:["entity","player","coords"]},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[.+?\((\d+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["entity","card","coords"],action:function(evt)
{this.card_on_tile_cache={entity:evt.entity,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+),\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.entity=this.card_on_tile_cache.entity;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/\[url=\"kingsdec:\/\/(\w+)\"\]/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/Matchmaking: NetworkRoomSteam: OnRoomPlayerDisconnected: .+ \(Player(\d)\), error (\w+)/i,map:["player","reason"]},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\): [^(]+ \((\w+)\)/i,map:["player","entity"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\): .+? \((\w+)\)/i,map:["player","entity"],},{name:"victory",re:/Winner: \[Player .+ \(Player(\d)\): [^(]+ \((\w+)\)/i,map:["player","entity"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{var match;var player;if(match=this.re_start.exec(line))
this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[]};else if((match=this.re_player.exec(line))&&(typeof this.matchinfo!=='undefined')&&(this.matchinfo.players.length<4))
this.matchinfo.players.push({name:match[1],steam:match[2]});else if(this.matchinfo&&(match=this.re_setuphero.exec(line))&&(player=this.matchinfo.players[parseInt(match[3])-1])&&(!player.hero))
player.hero=match[1];else if((match=this.re_end.exec(line))&&(typeof this.matchinfo!=='undefined'))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['1.10.0.0']=new Parser({pre_heroes_completed:{},re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: InGameState/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: Exiting matchmaking state: InGameState|Analytics: (?:AnalyticsController: )?OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: \w+, Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_spawnhero:/NetworkGame: \w+ \[Process\] \w+#Sync#SetupPlayerHero#\d\s+\(Processing\) \(Player(\d), (\d+),/i,re_setuphero:/\[Hero (\w+) \((\d+)\):/i,heroes_completed:{},player_quit_events:[false,false,false,false],chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s* \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] \w+#Sync#SetupPlayerHero#\d  \(Processing\) \(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["type","entity","coords"],action:function(evt)
{if(!this.heroes_completed[evt.entity])
{this.heroes_completed[evt.entity]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\d+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\(.+?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero [^\(]+ \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"toggleBounty",re:/Gameplay: SpecialStatusManager\+Message\+StatusUpdated: Dispatch\(\[Hero \w+ \((\d+)\):.+?\], LeagueOfGeeks.ArmelloEngine.Bounty,/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["entity","coords"]},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[Player.+?\(Player(\d)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["player","card","coords"],action:function(evt)
{this.card_on_tile_cache={player:evt.player,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+)[^,]*,\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/\[url=\"kingsdec:\/\/(\w+)\"\]/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/Matchmaking: NetworkRoomSteam: OnPlayerLeft: .+? \(Player(\d)\), (\w+)/i,map:["player","reason"],action:function(evt)
{let p=parseInt(evt.player,10);if(!this.player_quit_events[p-1])
{this.player_quit_events[p-1]=true;return evt;}
else
return undefined;}},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\)/i,map:["player"]},{name:"victory",re:/Winner:\s*\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{var match;var player;if(match=this.re_start.exec(line))
{this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[]};this.pre_heroes_completed={};}
else if((match=this.re_player.exec(line))&&(typeof this.matchinfo!=='undefined')&&(this.matchinfo.players.length<4))
this.matchinfo.players.push({name:match[1],steam:match[2]});else if(this.matchinfo&&(match=this.re_spawnhero.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];if(!player.heroid)
player.heroid=match[2];}
else if(this.matchinfo&&(match=this.re_setuphero.exec(line))&&!this.pre_heroes_completed[match[2]])
{for(let p=0;p<4;p++)
if(this.matchinfo.players[p].heroid==match[2])
{this.matchinfo.players[p].hero=match[1];this.pre_heroes_completed[match[2]]=true;break;}}
else if((match=this.re_end.exec(line))&&(typeof this.matchinfo!=='undefined'))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['1.11.0.0']=new Parser({pre_heroes_completed:{},re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: InGameState/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: Exiting matchmaking state: InGameState|Analytics: (?:AnalyticsController: )?OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: \w+, Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_spawnhero:/NetworkGame: \w+ \[Process\] \w+#Sync#SetupPlayerHero#\d\s+\(Processing\) \(Player(\d), (\d+),/i,re_setuphero:/\[Hero (\w+) \((\d+)\):/i,heroes_completed:{},player_quit_events:[false,false,false,false],chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s* \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] \w+#Sync#SetupPlayerHero#\d  \(Processing\) \(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["type","entity","coords"],action:function(evt)
{if(!this.heroes_completed[evt.entity])
{this.heroes_completed[evt.entity]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\d+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\(.+?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero [^\(]+ \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"toggleBounty",re:/Gameplay: SpecialStatusManager\+Message\+StatusUpdated: Dispatch\(\[Hero \w+ \((\d+)\):.+?\], LeagueOfGeeks.ArmelloEngine.Bounty,/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["entity","coords"]},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[Player.+?\(Player(\d)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["player","card","coords"],action:function(evt)
{this.card_on_tile_cache={player:evt.player,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+)[^,]*,\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/\[url=\"kingsdec:\/\/(\w+)\"\]/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/Matchmaking: NetworkRoomSteam: OnPlayerLeft: .+? \(Player(\d)\), (\w+)/i,map:["player","reason"],action:function(evt)
{let p=parseInt(evt.player,10);if(!this.player_quit_events[p-1])
{this.player_quit_events[p-1]=true;return evt;}
else
return undefined;}},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\)/i,map:["player"]},{name:"victory",re:/Winner:\s*\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{var match;var player;if(match=this.re_start.exec(line))
{this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[]};this.pre_heroes_completed={};}
else if((match=this.re_player.exec(line))&&(typeof this.matchinfo!=='undefined')&&(this.matchinfo.players.length<4))
this.matchinfo.players.push({name:match[1],steam:match[2]});else if(this.matchinfo&&(match=this.re_spawnhero.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];if(!player.heroid)
player.heroid=match[2];}
else if(this.matchinfo&&(match=this.re_setuphero.exec(line))&&!this.pre_heroes_completed[match[2]])
{for(let p=0;p<4;p++)
if(this.matchinfo.players[p].heroid==match[2])
{this.matchinfo.players[p].hero=match[1];this.pre_heroes_completed[match[2]]=true;break;}}
else if((match=this.re_end.exec(line))&&(typeof this.matchinfo!=='undefined'))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['1.12.0.0']=new Parser({re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: BeginMatchState/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: Exiting matchmaking state: InGameState|Analytics: (?:AnalyticsController: )?OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: Player(\d), Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_setuphero:/Player: Player\+Message\+PlayerGameStateChanged: Dispatch\(\[Player .+ \(Player(\d)\): Hero=\[Creature=\[Hero (\w+) \((\d+)\):/i,heroes_completed:{},player_quit_events:[false,false,false,false],chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s* \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] \w+#Sync#SetupPlayerHero#\d\s+\(Processing\)\s+\(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["type","entity","coords"],action:function(evt)
{if(!this.heroes_completed[evt.entity])
{this.heroes_completed[evt.entity]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\d+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(!this.combat_cache)return undefined;let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"predictSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\(.+?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero [^\(]+ \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"toggleBounty",re:/Gameplay: SpecialStatusManager\+Message\+StatusUpdated: Dispatch\(\[Hero \w+ \((\d+)\):.+?\], LeagueOfGeeks.ArmelloEngine.Bounty,/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["entity","coords"]},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[Player.+?\(Player(\d)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["player","card","coords"],action:function(evt)
{this.card_on_tile_cache={player:evt.player,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+)[^,]*,\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/\[url=\"kingsdec:\/\/(\w+)\"\]/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/Matchmaking: NetworkRoomSteam: OnPlayerLeft: .+? \(Player(\d)\), (\w+)/i,map:["player","reason"],action:function(evt)
{let p=parseInt(evt.player,10);if(!this.player_quit_events[p-1])
{this.player_quit_events[p-1]=true;return evt;}
else
return undefined;}},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\)/i,map:["player"]},{name:"victory",re:/Winner:\s*\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{let match;let player;if(match=this.re_start.exec(line))
{this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[{},{},{},{}]};}
else if(this.matchinfo&&(match=this.re_player.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.name=match[2];player.steam=match[3];}
else if(this.matchinfo&&(match=this.re_setuphero.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.heroid=match[3];player.hero=match[2];}
else if(this.matchinfo&&(match=this.re_end.exec(line)))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['1.12.1.0']=new Parser({tile_alias:{"King":"KingTile","KingsPalaceNorth":"KingsPalace","KingsPalaceEast":"KingsPalace","KingsPalaceSouth":"KingsPalace","KingsPalaceWest":"KingsPalace",},re_start:/(\d+:\d+:\d+)\W+Matchmaking: Entering matchmaking state: BeginMatchState/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: Exiting matchmaking state: InGameState|Analytics: (?:AnalyticsController: )?OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: Player(\d), Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_setuphero:/Player: Player\+Message\+PlayerGameStateChanged: Dispatch\(\[Player .+ \(Player(\d)\): Hero=\[Creature=\[Hero (\w+) \((\d+)\):/i,heroes_completed:{},player_quit_events:[false,false,false,false],first_prestige_event:false,chat_prepared:undefined,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"addTile",re:/\[Tile: Pos=\((-?\d+,-?\d+)\), Type=(\w+)/i,map:["coords","type"],action:function(evt)
{if(evt.type in this.tile_alias)
evt.type=this.tile_alias[evt.type];return evt;}},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s+\((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] (?:\w+#Sync#SetupPlayerHero#\d+\s+\(Processing\)|\S+ SetupPlayerHero)\s+\(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["type","entity","coords"],action:function(evt)
{if(!this.heroes_completed[evt.entity])
{this.heroes_completed[evt.entity]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\d+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(this.combat_cache)
{let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}
else if(this.peril_cache)
this.peril_cache.dice.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});return undefined;}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(this.combat_cache)
{let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}
else if(this.peril_cache)
{let type=(evt.type=="Perils")?"Match":evt.type;this.peril_cache.dice.rolls.push({symbol:evt.symbol,type:type,source:evt.source});}
return undefined;}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+ApplyEffectInSequence: Dispatch\(\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"predictSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\(.+?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero [^\(]+ \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"toggleBounty",re:/Gameplay: SpecialStatusManager\+Message\+StatusUpdated: Dispatch\(\[Hero \w+ \((\d+)\):.+?\], LeagueOfGeeks.ArmelloEngine.Bounty,/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["entity","coords"],action:function(evt)
{this.peril_cache={coords:evt.coords,entity:evt.entity,dice:{total:0,parts:[],rolls:[]}};return evt;}},{name:"takePeril",re:/Player: Player\+Message\+TakePerilEffect: Dispatch\(\[.+?\((\d+)\):.+?\], \[Card \w+: Asset:(\w+).+?\], \[Player .+? \(Player(\d)\):/i,map:["entity","card","player"]},{name:"completePeril",re:/Peril: PerilChallenge\+Message\+Resolve: Dispatch\(LeagueOfGeeks\.ArmelloEngine\.PerilChallenge, (\w+)\)/i,map:["result"],action:function(evt)
{if(!this.peril_cache)
return undefined;else
{evt.coords=this.peril_cache.coords;evt.entity=this.peril_cache.entity;evt.dice=this.peril_cache.dice;this.peril_cache=undefined;return evt;}}},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[Player.+?\(Player(\d)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["player","card","coords"],action:function(evt)
{this.card_on_tile_cache={player:evt.player,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+)[^,]*,\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/NetworkGame: Player\d \[Process\] \S+ ConfirmPlayerPrestigePosition\s+\(Player(\d), 0\)/i,map:["player"],action:function(evt)
{if(!this.first_prestige_event)
{this.first_prestige_event=true;return evt;}},},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/NetworkGame: Player\d+ \[Process\] (?:Player\d|Server)#[^ ]+ ChooseKingsDeclarationRequest\s+\((\w+)\)/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/NetworkGame: DisconnectPlayer: Player(\d)/i,map:["player"],action:function(evt)
{let p=parseInt(evt.player,10);if(!this.player_quit_events[p-1])
{this.player_quit_events[p-1]=true;return evt;}
else
return undefined;}},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\)/i,map:["player"]},{name:"victory",re:/Winner:\s*\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+),/i,map:["player","type"],action:function(evt)
{this.chat_prepared=evt;return undefined;}},{name:"chat",re:/Game: \[.+\]: (.+)/i,map:["message"],action:function(evt)
{if(!this.chat_prepared)return undefined;this.chat_prepared.message=evt.message;let e=this.chat_prepared;this.chat_prepared=undefined;return e;}},],function(line,pos)
{let match;let player;if(match=this.re_start.exec(line))
{this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[{},{},{},{}]};}
else if(this.matchinfo&&(match=this.re_player.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.name=match[2];player.steam=match[3];}
else if(this.matchinfo&&(match=this.re_setuphero.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.heroid=match[3];player.hero=match[2];}
else if(this.matchinfo&&(match=this.re_end.exec(line)))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['2.0.0.0']=new Parser({tile_alias:{"King":"KingTile","KingsPalaceNorth":"KingsPalace","KingsPalaceEast":"KingsPalace","KingsPalaceSouth":"KingsPalace","KingsPalaceWest":"KingsPalace",},platformtosteam:{},re_start:/(\d+:\d+:\d+)\W+Matchmaking: (?:MatchmakingControllerPrimary\.BeginMatchState: OnEnter|GameOptionSetupSP: GameOptionSetupSP: GameOptionsBeginMatch)/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: MatchmakingControllerPrimary\.InGameState: OnExit|Analytics: OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: Player(\d), Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_steamid:/Matchmaking:\s*.+? \(id:(\w+)\): OnServerSetPlayerProperty: PlatformId = (\d+)/i,re_setuphero:/\[Player .+ \(Player(\d)\): Hero=\[Creature=\[Hero (\w+) \((\d+)\):/i,heroes_completed:{},player_quit_events:[false,false,false,false],first_prestige_event:false,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"]},{name:"addTile",re:/\[Tile: Pos=\((-?\d+,-?\d+)\), Type=(\w+)/i,map:["coords","type"],action:function(evt)
{if(evt.type in this.tile_alias)
evt.type=this.tile_alias[evt.type];return evt;}},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s+\((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] (?:\w+#Sync#SetupPlayerHero#\d+\s+\(Processing\)|\S+ SetupPlayerHero)\s+\(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["type","entity","coords"],action:function(evt)
{if(!this.heroes_completed[evt.entity])
{this.heroes_completed[evt.entity]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\w+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\d+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(this.combat_cache)
{let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}
else if(this.peril_cache)
this.peril_cache.dice.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});return undefined;}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(this.combat_cache)
{let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}
else if(this.peril_cache)
{let type=(evt.type=="Perils")?"Match":evt.type;this.peril_cache.dice.rolls.push({symbol:evt.symbol,type:type,source:evt.source});}
return undefined;}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+(?:PrepareTo)?ApplyEffectInSequence: Dispatch\(.*?\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"predictSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\(.+?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero [^\(]+ \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"updateBounty",re:/Gameplay: SpecialStatusManager\+Message\+StatusUpdated: Dispatch\(\[Hero \w+ \((\d+)\):.+?\], LeagueOfGeeks.ArmelloEngine.Bounty,/i,map:["entity"]},{name:"toggleCorrupted",re:/Gameplay: Corrupted\+Message\+CorruptedChanged: Dispatch\(\[[^(]+ \((\d+)\):.+?\]/i,map:["entity"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["entity","coords"],action:function(evt)
{this.peril_cache={coords:evt.coords,entity:evt.entity,dice:{total:0,parts:[],rolls:[]}};return evt;}},{name:"completePeril",re:/Peril: PerilChallenge\+Message\+Resolve: Dispatch\(LeagueOfGeeks\.ArmelloEngine\.PerilChallenge, (\w+)\)/i,map:["result"],action:function(evt)
{if(!this.peril_cache)
return undefined;else
{evt.coords=this.peril_cache.coords;evt.entity=this.peril_cache.entity;evt.dice=this.peril_cache.dice;this.peril_cache=undefined;return evt;}}},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[Player.+?\(Player(\d)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["player","card","coords"],action:function(evt)
{this.card_on_tile_cache={player:evt.player,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+)[^,]*,\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"settlementFortified",re:/Gameplay: Tile\+Message\+SettlementFortified: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], \[Hero \w+ \((\d+)\):/i,map:["coords","entity"],action:function(evt)
{if(!this.card_on_tile_cache||(this.card_on_tile_cache.coords!=evt.coords))
return evt;else
{this.card_on_tile_cache=undefined;return undefined;}}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/NetworkGame: Player\d \[Process\] \S+ ConfirmPlayerPrestigePosition\s+\(Player(\d), 0\)/i,map:["player"],action:function(evt)
{if(!this.first_prestige_event)
{this.first_prestige_event=true;return evt;}},},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/NetworkGame: Player\d+ \[Process\] (?:Player\d|Server)#[^ ]+ ChooseKingsDeclarationRequest\s+\((\w+)\)/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/NetworkGame: DisconnectPlayer: Player(\d)/i,map:["player"],action:function(evt)
{let p=parseInt(evt.player,10);if(!this.player_quit_events[p-1])
{this.player_quit_events[p-1]=true;return evt;}
else
return undefined;}},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\)/i,map:["player"]},{name:"victory",re:/Winner:\s*\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+), (?:Invalid|Player(\d))\)/i,map:["player","type","target"],},],function(line,pos)
{let match;let player;if(match=this.re_start.exec(line))
{this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[{},{},{},{}]};}
else if(this.matchinfo&&(match=this.re_player.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.name=match[2];player.networkid=match[3];player.steam=this.platformtosteam[match[3]];}
else if(match=this.re_steamid.exec(line))
this.platformtosteam[match[1]]=match[2];else if(this.matchinfo&&(match=this.re_setuphero.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.heroid=match[3];player.hero=match[2];}
else if(this.matchinfo&&(match=this.re_end.exec(line)))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">Parser.Parsers['2.1.0.0']=new Parser({found_tiles:{},tile_alias:{"King":"KingTile","KingsPalaceNorth":"KingsPalace","KingsPalaceEast":"KingsPalace","KingsPalaceSouth":"KingsPalace","KingsPalaceWest":"KingsPalace",},platformtosteam:{},re_start:/(\d+:\d+:\d+)\W+Matchmaking: (?:MatchmakingControllerPrimary\.BeginMatchState: OnEnter|GameOptionSetupSP: GameOptionSetupSP: GameOptionsBeginMatch)/i,re_end:/(\d+:\d+:\d+)\W+(?:Matchmaking: MatchmakingControllerPrimary\.InGameState: OnExit|Analytics: OnAppQuit:)/i,re_player:/Gameplay:\s*\[\s*\w+\s*\] Id: Player(\d), Name:\s*([^,]+), Network Id:\s*(\w+)\s*, Hero:\s*\w+/i,re_steamid:/Matchmaking:\s*.+? \(id:(\w+)\): OnServerSetPlayerProperty: PlatformId = (\d+)/i,re_setuphero:/\[Player .+ \(Player(\d)\): Hero=\[Creature=\[Hero (\w+) \((\d+)\):/i,heroes_completed:{},player_quit_events:[false,false,false,false],first_prestige_event:false,disconnect_cache:undefined,card_on_hero_cache:undefined,card_on_tile_cache:undefined,},[{name:"addTile",re:/MapMaking:\s*Creating clan castle tile for quadrant (\w+) on position: \((-?\d+,-?\d+)\),/i,map:["corner","coords"],action:function(evt)
{this.found_tiles[evt.coords]=true;evt.type="ClanCastle";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating clan castle-adjacent plains tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{this.found_tiles[evt.coords]=true;evt.type="Plains";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King's Palace Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{this.found_tiles[evt.coords]=true;evt.type="KingsPalace";return evt;}},{name:"addTile",re:/MapMaking:\s*Creating King Tile on position: \((-?\d+,-?\d+)\),/i,map:["coords"],action:function(evt)
{this.found_tiles[evt.coords]=true;evt.type="KingTile";return evt;}},{name:"addTile",re:/MapMaking:\s*- Created (?:Feature )?Tile of Type: (\w+) at position: \((-?\d+,-?\d+)\),/i,map:["type","coords"],action:function(evt)
{this.found_tiles[evt.coords]=true;return evt;}},{name:"addTile",re:/\[Tile: Pos=\((-?\d+,-?\d+)\), Type=(\w+)/i,map:["coords","type"],action:function(evt)
{if(!(evt.coords in this.found_tiles))
{this.found_tiles[evt.coords]=true;if(evt.type in this.tile_alias)
evt.type=this.tile_alias[evt.type];return evt;}}},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \w+#Sync#Spawn(\w+?)(?:AsAuthority)?#\d+\s*\(Processing\) \((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnNPC",re:/NetworkGame: \w+ \[Process\] \S+ Spawn(\w+?)(?:AsAuthority)?\s+\((\d+), \((-?\d+,-?\d+)\)/i,map:["type","entity","coords"]},{name:"spawnIllusion",re:/NetworkGame: \w+ \[Process\] Server#\d+ SpawnIllusion(?:AsAuthority)?\s+\(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"spawnHero",re:/NetworkGame: \w+ \[Process\] (?:\w+#Sync#SetupPlayerHero#\d+\s+\(Processing\)|\S+ SetupPlayerHero)\s+\(Player(\d), (\d+), \((-?\d+,-?\d+)\)/i,map:["player","entity","coords"]},{name:"setupHero",re:/\[Hero (\w+) \((\d+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["type","entity","coords"],action:function(evt)
{if(!this.heroes_completed[evt.entity])
{this.heroes_completed[evt.entity]=true;return evt;}}},{name:"moveEntity",re:/Gameplay: Creature\+Message\+SnapPosition: Dispatch\(\[.+? \((\d+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"moveEntity",re:/Gameplay: Creature\+Message\+MoveEnd: Dispatch\(\[.+? \((\d+)\):.+?Pos=\((-?\d+,-?\d+)\)/,map:["entity","coords"]},{name:"attack",re:/Combat:\s+(Attacker|Defender): \[.+?\((\d+)\):/i,map:["role","entity"],action:function(evt)
{if(evt.role==="Attacker")
{this.attacker=evt.entity;return undefined;}
else
{evt.attacker=this.attacker;evt.defender=evt.entity;this.combat_cache={attacker:evt.attacker,attacker_dice:{total:0,parts:[],rolls:[]},defender:evt.defender,defender_dice:{total:0,parts:[],rolls:[]},};delete this.attacker;delete evt.role;delete evt.entity;return evt;}}},{name:"modifyDiceCounts",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\]: (AddDice|RemoveDice)\((\d+)\) from source (.+?) for a total of (\d+)/,map:["entity","type","mod","source","value"],action:function(evt)
{if(this.combat_cache)
{let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.total=parseInt(evt.value,10);target.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});}
else if(this.peril_cache)
this.peril_cache.dice.parts.push({value:((evt.type=="AddDice")?+1:-1)*parseInt(evt.mod,10),source:evt.source});return undefined;}},{name:"resolveDice",re:/Dice: DiceRollConfig\[\[.+? \((\w+)\):.+\]\] PushResolution \[SymbolResData: (\w+),(\w+),(-?\d+),(\w+)\]/i,map:["entity","symbol","type","mod","source"],action:function(evt)
{if(this.combat_cache)
{let target;if(this.combat_cache.attacker==evt.entity)
target=this.combat_cache.attacker_dice;else if(this.combat_cache.defender==evt.entity)
target=this.combat_cache.defender_dice;else
return undefined;target.rolls.push({symbol:evt.symbol,type:evt.type,source:evt.source});}
else if(this.peril_cache)
{let type=(evt.type=="Perils")?"Match":evt.type;this.peril_cache.dice.rolls.push({symbol:evt.symbol,type:type,source:evt.source});}
return undefined;}},{name:"combatEnd",re:/Combat: CombatManager\.DoApplyCombat combatResult\.(Attacking|Defending)PlayerResult == CombatResult\.Result\.(\w+)/i,map:["source","result"],action:function(evt)
{if(!this.combat_cache)return undefined;let res=this.combat_cache;delete this.combat_cache;res.outcome=evt.source+"-"+evt.result;res.name=evt.name;return res;}},{name:"killEntity",re:/Gameplay: Creature\+Message\+DeathEnd: Dispatch\(\[(?:[^(]+) \((\d+)\):/i,map:["entity"]},{name:"applyKingsDecToGuard",re:/KingsDec: KingsEffects\+Message\+(?:PrepareTo)?ApplyEffectInSequence: Dispatch\(.*?\[King's Guard.+?\((\d+)\):/i,map:["entity"]},{name:"predictBane",re:/Gameplay: Tile\+Message\+BaneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"predictSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawnSet: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\).+\], (\w+)\)/i,map:["coords","active"]},{name:"spawnSpiritStone",re:/Gameplay: Tile\+Message\+SpiritStoneSpawned: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"removeSpiritStone",re:/GameplayVisualization: HeroController\+Message\+SpiritStoneCollectCompleted: Dispatch\(.+?, \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["coords"]},{name:"addEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"removeEffect",re:/Gameplay: CreatureStatusEffectManager\+Message\+LoseStatusEffect: Dispatch\(\[[^(]+ \((\d+)\):.+?\], StatusEffect\s*\[Source:(\w+)/i,map:["entity","card"]},{name:"equipCard",re:/Gameplay: Creature\+Message\+EquipCard: Dispatch\(\[[^\(]+ \((\w+)\).+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\d)/i,map:["entity","card","slot"]},{name:"unequipCard",re:/Gameplay: Creature\+Message\+UnequipCard: Dispatch\(\[[^(]+ \((\w+)\).+?Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], (\w+), (\d)/i,map:["entity","card","reason","slot"]},{name:"gainCard",re:/Player: Player\+Message\+AddCardToHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \w+, (\w+)\)/i,map:["player","card","source"]},{name:"loseCard",re:/Player: Player\+Message\+RemoveCardFromHand: Dispatch\(\[Player.+?\(Player(\d)\):.+?\[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\]\)/i,map:["player","card"]},{name:"changeStats",re:/Gameplay: CreatureStats\+Message\+ChangeStats: Dispatch\(\[StatsChange: (\w+): creature:\[.+ \((\d+)\):.+?\] mod:(-?\d+) now:(-?\d+)\]\)/i,map:["stat","entity","delta","value"]},{name:"playCardOnCreature",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[[^\(]+ \((\d+)\):/i,map:["player","card","entity"]},{name:"preGainPact",re:/Player: Player\+Message\+PlayCardOnCreature: Dispatch\(\[Player .+? \(Player(\d)\):.+?\], \[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+], \[Hero [^\(]+ \((\d+)\):/i,map:["player","card","entity"],action:function(evt)
{this.card_on_hero_cache={player:evt.player,entity:evt.entity,card:evt.card};return undefined;}},{name:"gainPact",re:/Gameplay: HeroPactManager\+Message\+GainPact:/i,map:[],action:function(evt)
{if(this.card_on_hero_cache)
{evt.player=this.card_on_hero_cache.player;evt.entity=this.card_on_hero_cache.entity;evt.card=this.card_on_hero_cache.card;this.card_on_hero_cache=undefined;return evt;}
else
return undefined;}},{name:"updateSpecialStatus",re:/Gameplay: SpecialStatusManager\+Message\+StatusUpdated: Dispatch\(\[Hero \w+ \((\d+)\):.+?\], LeagueOfGeeks\.ArmelloEngine\.(\w+), (.*)\)/i,map:["entity","status","data"]},{name:"putPeril",re:/Peril: Tile\+Message\+AddPeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:(\w+) type:\w+ isTemp:\w+\], OwnerId=(\w+)\]\)/i,map:["coords","peril","card","owner"]},{name:"encounterPeril",re:/Gameplay: Creature\+Message\+PerilChallengeBegin: Dispatch\(\[Hero \w+ \((\w+)\):.*?Pos=\((-?\d+,-?\d+)\)/i,map:["entity","coords"],action:function(evt)
{this.peril_cache={coords:evt.coords,entity:evt.entity,dice:{total:0,parts:[],rolls:[]}};return evt;}},{name:"completePeril",re:/Peril: PerilChallenge\+Message\+Resolve: Dispatch\(LeagueOfGeeks\.ArmelloEngine\.PerilChallenge, (\w+)\)/i,map:["result"],action:function(evt)
{if(!this.peril_cache)
return undefined;else
{evt.coords=this.peril_cache.coords;evt.entity=this.peril_cache.entity;evt.dice=this.peril_cache.dice;this.peril_cache=undefined;return evt;}}},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[King \((\d+)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["entity","card","coords"],action:function(evt)
{this.card_on_tile_cache={entity:evt.entity,card:evt.card,coords:evt.coords};return evt;}},{name:"playCardOnTile",re:/Player: Player\+Message\+PlayCardOnTile: Dispatch\(\[Player.+?\(Player(\d)\):.+?\], \[Card \w+: Asset:(\w+) type:\w+ isTemp:\w+\], \[Tile: Pos=\((-?\d+,-?\d+)\),/i,map:["player","card","coords"],action:function(evt)
{this.card_on_tile_cache={player:evt.player,card:evt.card,coords:evt.coords};return evt;}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+SymbolBuffLevelChanged: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"buffPeril",re:/Gameplay: Peril\+Message\+StatusEffectAdded: Dispatch\(\[Peril \((\w+)\):/i,map:["peril"],action:function(evt)
{if(this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.card=this.card_on_tile_cache.card;evt.coords=this.card_on_tile_cache.coords;this.card_on_tile_cache=undefined;return evt;}}},{name:"clearPeril",re:/Peril: Tile\+Message\+RemovePeril: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], \[Peril \((\w+)\): Card=\[Card \d+: Asset:\w+ type:\w+ isTemp:\w+\], OwnerId=\w+\]\)/i,map:["coords","peril"]},{name:"addTileEffect",re:/Gameplay: TileStatusEffectManager\+Message\+GainStatusEffect: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=\w+\], StatusEffect\[Source:(\w+)[^,]*,\s*Type:(\w+)\]\)/i,map:["coords","card","type"]},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementReleased|SettlementCaptured): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, (\w+),/i,map:["type","coords","reason"],action:function(evt)
{if((evt.reason=='Card')&&this.card_on_tile_cache)
{evt.player=this.card_on_tile_cache.player;evt.reason=this.card_on_tile_cache.card;this.card_on_tile_cache=undefined;}
return evt;}},{name:"settlementChangeOwner",re:/Gameplay: Tile\+Message\+(SettlementTerrorised): Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], [^,]+, \[.+ \((\d+)\):.+?\]/i,map:["type","coords","entity"],action:function(evt)
{evt.reason="Entity";return evt;}},{name:"settlementFortified",re:/Gameplay: Tile\+Message\+SettlementFortified: Dispatch\(\[Tile: Pos=\((-?\d+,-?\d+)\), Type=Settlement\], \[Hero \w+ \((\d+)\):/i,map:["coords","entity"],action:function(evt)
{if(!this.card_on_tile_cache||(this.card_on_tile_cache.coords!=evt.coords))
return evt;else
{this.card_on_tile_cache=undefined;return undefined;}}},{name:"setQuest",re:/Quest: OnSpawnQuestComplete - player: Player(\d), quest: \w+, questTilePos: \((-?\d+,-?\d+)\), success: True/i,map:["player","coords"]},{name:"completeQuest",re:/Gameplay: QuestManager\+Message\+CompleteQuest/i,map:[]},{name:"prestigeLeader",re:/NetworkGame: Player\d \[Process\] \S+ ConfirmPlayerPrestigePosition\s+\(Player(\d), 0\)/i,map:["player"],action:function(evt)
{if(!this.first_prestige_event)
{this.first_prestige_event=true;return evt;}},},{name:"prestigeLeader",re:/Gameplay:\s+Game\+Message\+NewPrestigeLeader:\s+Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"declaration",re:/NetworkGame: Player\d+ \[Process\] (?:Player\d|Server)#[^ ]+ ChooseKingsDeclarationRequest\s+\((\w+)\)/i,map:["type"]},{name:"playerStart",re:/Gameplay:\s+\[\s*(\w+)\s*\]\s+Id:\s+Player(\d),\s+Name:\s+([^,]+), Network Id:\s*(\w+),/i,map:["loc","player","alias","steam"]},{name:"playerQuit",re:/NetworkGame: DisconnectPlayer: Player(\d)/i,map:["player"],action:function(evt)
{let p=parseInt(evt.player,10);if(!this.player_quit_events[p-1])
{this.player_quit_events[p-1]=true;return evt;}
else
return undefined;}},{name:"nextRound",re:/Game: TurnManager\+Message\+PhaseStartForKing: Dispatch\((\w+)\)/i,map:["type"]},{name:"startTurn",re:/Player: Player\+Message\+StartTurn: Dispatch\(\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"startTurn",re:/AI: NPC\+Message\+StartTurn: Dispatch\(\[.+? \((\w+)\):/i,map:["entity"]},{name:"endTurn",re:/Gameplay: Player\+Message\+EndTurn: Dispatch\(\[Player .+? \(Player(\d)\)/i,map:["player"]},{name:"victory",re:/Winner:\s*\[Player .+ \(Player(\d)\):/i,map:["player"]},{name:"chat",re:/NetworkGame: PlayerChat\+Message\+ChatMessageReceived: Dispatch\(Player(\d), (\w+), (?:Invalid|Player(\d))\)/i,map:["player","type","target"],},],function(line,pos)
{let match;let player;if(match=this.re_start.exec(line))
{this.matchinfo={starttime:match[1],startpos:pos,endtime:"",endpos:0,players:[{},{},{},{}]};}
else if(this.matchinfo&&(match=this.re_player.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.name=match[2];player.networkid=match[3];player.steam=this.platformtosteam[match[3]];}
else if(match=this.re_steamid.exec(line))
this.platformtosteam[match[1]]=match[2];else if(this.matchinfo&&(match=this.re_setuphero.exec(line)))
{player=this.matchinfo.players[parseInt(match[1])-1];player.heroid=match[3];player.hero=match[2];}
else if(this.matchinfo&&(match=this.re_end.exec(line)))
{var info=this.matchinfo;delete this.matchinfo;info.endtime=match[1];info.endpos=pos;return info;}});</script>
	<script data-loader="true">function FileProcessor(zone,handler,color1,color2)
{this.zone=zone;if(zone.hasAttribute('for'))
this.input=document.getElementById(zone.getAttribute('for'));this.handler=handler;this.color1=color1;this.color2=color2;this.zone.addEventListener('click',FileProcessor.prototype.Click.bind(this),false);this.zone.addEventListener('dragover',FileProcessor.prototype.DragFileOver.bind(this),false);this.zone.addEventListener('drop',FileProcessor.prototype.FileDropped.bind(this),false);this.zone.addEventListener('dragend',FileProcessor.prototype.FileDragEnd.bind(this),false);this.zone.addEventListener('dragexit',FileProcessor.prototype.FileDragExit.bind(this),false);this.update=FileProcessor.prototype.update.bind(this);}
FileProcessor.prototype=Object.create({});FileProcessor.prototype.disable=function()
{if(('input'in this)&&!this.input.hasAttribute('disabled'))
this.input.setAttribute('disabled','true');};FileProcessor.prototype.enable=function()
{if(('input'in this)&&this.input.hasAttribute('disabled'))
this.input.removeAttribute('disabled');};FileProcessor.prototype.Click=function(evt)
{if(('input'in this)&&this.input.hasAttribute('disabled'))
evt.preventDefault();};FileProcessor.prototype.DoNothing=function(evt){evt.preventDefault();}
FileProcessor.prototype.DragFileOver=function(evt)
{evt.preventDefault();var cls=this.zone.hasAttribute('class')?this.zone.getAttribute('class'):'';if(!/\bdrag\b/.test(cls))
this.zone.setAttribute('class',cls+' drag');};FileProcessor.prototype.FileDragExit=function(evt)
{evt.preventDefault();this.zone.setAttribute('class',this.zone.getAttribute('class').replace(/\s*drag\b/,''));};FileProcessor.prototype.FileDropped=function(evt)
{evt.preventDefault();if(document.getElementById('log').hasAttribute('disabled'))return;this.zone.setAttribute('class',this.zone.getAttribute('class').replace(/\s*drag\b/,''));var file;var dt=evt.dataTransfer;if(dt.items)
{for(let i=0;i<dt.items.length;i++)
if(dt.items[i].kind==='file')
{file=dt.items[i].getAsFile();break;}}
else
{if(dt.files.length>0)
file=dt.files[0];}
if(typeof file!=='undefined')
this.handler(file,this.update);};FileProcessor.prototype.FileDragEnd=function(evt)
{var dt=evt.dataTransfer;if(dt.items)
for(var i=0;i<dt.items.length;i++)
dt.items.remove(i);else
dt.clearData();};FileProcessor.prototype.update=function(rate,message)
{this.zone.style.background="linear-gradient(90deg, "+this.color1+", "+this.color1+" "+rate+"%, "+this.color2+" "+rate+"%, "+this.color2+")";if(typeof message!=='undefined')
this.zone.innerHTML=message;};function LogFileSelected(file,update)
{document.getElementById('log').setAttribute('disabled','true');var recommendedParser;let items=document.getElementById('matches');while(items.firstChild)items.removeChild(items.firstChild);update(0,"Looking for matches in "+file.name);Parser.provideParserForFile(file).then(function(parser)
{recommendedParser=parser;return parser.findMatches(file,function(line,pos)
{update((100.0*pos)/file.size);});}).then(function(matches)
{if(matches.length>0)
{for(var i=0;i<matches.length;i++)
{let item=document.createElement('li');let btn=document.createElement('button');btn.setAttribute('class','loadmatch');btn.innerHTML='Load';item.appendChild(btn);btn.dataslice=file.slice(matches[i].startpos,matches[i].endpos);btn.parser=recommendedParser;let starttime=matches[i].starttime.split(':').map(function(x){return parseInt(x,10)});let endtime=matches[i].endtime.split(':').map(function(x){return parseInt(x,10)});let duration=(endtime[0]*3600+endtime[1]*60+endtime[2])-(starttime[0]*3600+starttime[1]*60+starttime[2]);if(duration<0)duration+=24*3600;let hours=Math.trunc(duration/3600).toString();let minutes=('0'+Math.trunc((duration%3600)/60).toString()).slice(-2);let seconds=('0'+Math.trunc(duration%60).toString()).slice(-2);let durationspan=document.createElement('span');durationspan.setAttribute('class','match-duration');durationspan.innerHTML=hours+':'+minutes+':'+seconds;item.appendChild(durationspan);for(var p=0;p<4;p++)
{let block=document.createElement('span');block.setAttribute('class','participant');let s=sanitize(matches[i].players[p].name);if((typeof matches[i].players[p].steam!=='undefined')&&(matches[i].players[p].steam!='0'))
s='<a href="https://steamcommunity.com/profiles/'+matches[i].players[p].steam+'">'+s+'</a>';if(typeof matches[i].players[p].hero!=='undefined')
s+="("+Name(matches[i].players[p].hero)+")";block.innerHTML=s;item.appendChild(block);}
items.appendChild(item);}
update(100,"Please choose a match to be loaded, or select another file.");}
else
{update(100,"No matches found! Please select another file.");}
document.getElementById('log').removeAttribute('disabled');}).catch(function(err)
{update(0,"Parsing error: "+err.toString());document.getElementById('log').removeAttribute('disabled');console.error(err);});}
function MatchSelected(file,parser,update)
{document.getElementById('log').setAttribute('disabled','true');update(0,"Extracting events...");parser.parseFile(file,function(line,pos)
{update((75.0*pos)/file.size);}).then(function(events)
{for(let i=0;i<events.length;i++)
if(events[i].name=="addTile")
window.ArmelloMatchState.processEvent(events[i]);var snapshots=[];var list=document.getElementById('turns');var container=undefined;var gamebegan=false;var turntakers=['Bear','Rabbit','Wolf','Rat','Bandit','Dragon','King','Bane'];var i=0;update(75,"Analyzing events...");var processSomeEvents=function(resolve,reject)
{try
{let target=Math.min(events.length,i+50);while(i<target)
{let injected=window.ArmelloMatchState.processEvent(events[i]);if(typeof injected!=='undefined')
{if(!Array.isArray(injected))
events.splice(i+1,0,injected);else
for(let j=0;j<injected.length;j++)
events.splice(i+j+1,0,injected[j]);}
if(!gamebegan&&(events[i].name==='nextRound'))
gamebegan=true;let desc=describeEvent(events[i]);if(gamebegan&&(typeof desc!=='undefined'))
{let turntakerid=window.ArmelloMatchState.context.active;let turntaker=(turntakerid)?window.ArmelloMatchState.entities.getItemById('id',turntakerid):undefined;if(!container&&(events[i].name in describeEvent.eventpairs))
{container=document.createElement('ul');container.setAttribute('class','event-container event-'+events[i].name);container.starting_event=events[i].name;list.appendChild(container);}
let li=document.createElement('li');li.innerHTML=desc;li.setAttribute('data-event-index',i);li.setAttribute('class','event event-'+events[i].name);if(turntaker)
for(let tidx=0;tidx<turntakers.length;tidx++)
if(turntaker.type.slice(0,turntakers[tidx].length)===turntakers[tidx])
{li.setAttribute('class',li.className+' '+turntakers[tidx]);if(container&&!container.turntaker)
{container.turntaker=turntakers[tidx];container.setAttribute('class',container.className+' '+turntakers[tidx]);}
break;}
if((events[i].name==='nextRound')||(events[i].name==='startTurn'))
{let index=snapshots.push(window.ArmelloMatchState.getSnapshot())-1;li.setAttribute('data-snapshot-index',index);container=undefined;}
if(container)
container.appendChild(li);else
list.appendChild(li);if(container&&(events[i].name===describeEvent.eventpairs[container.starting_event]))
container=undefined;}
events[i].snapshot_index=snapshots.length-1;i++;}
update(75+(25.0*i)/events.length);if(i<events.length)
setTimeout(function(){processSomeEvents(resolve,reject);},0);else
resolve({events:events,snapshots:snapshots});}
catch(err)
{reject(err);}};return new Promise(processSomeEvents);}).then(function(data)
{let storage=document.createElement('script');storage.innerHTML="window.ArmelloMatchEvents = "+JSON.stringify(data.events).replace(/</g,'\\u003c')+";\r\n"+
"window.ArmelloMatchSnapshots = "+JSON.stringify(data.snapshots).replace(/</g,'\\u003c')+";";document.head.appendChild(storage);switchToMainView();let first=document.querySelector('#turns *[data-snapshot-index]')
jumpToEvent(first.getAttribute('data-event-index'),true);}).catch(function(err)
{let log=document.getElementById('log')
if(log)log.removeAttribute('disabled');update(0,"Parsing error: "+err.toString());console.error(err);});}</script>
	<script>function renderMap(canvas,context,highlight)
{let ctx=canvas.getContext('2d');ctx.clearRect(0,0,canvas.width,canvas.height);for(let i=0;i<context.map.items.length;i++)
{let tile=context.map.items[i];renderTile(tile,ctx);renderTileEffects(tile,ctx,context.entities);}
for(let i=0;i<context.markers.items.length;i++)
renderMarker(context.markers.items[i],context,ctx);for(let i=0;i<context.entities.items.length;i++)
{let e=context.entities.items[i];if(!e.dead)
renderEntity(e,ctx);}
if(highlight)
{cnv=gridToCanvas(highlight.u,highlight.v);ctx.beginPath();ctx.strokeStyle='white';ctx.setLineDash([]);ctx.lineWidth=4;ctx.arc(cnv.x,cnv.y,ctx.lineWidth+gridToCanvas.tileSize,0,2*Math.PI);ctx.stroke();}}
function gridToCanvas(u,v)
{if((u==gridToCanvas.uKing)&&(v==gridToCanvas.vKing))
{u=1.5;v=4;}
return{x:gridToCanvas.xOffset+gridToCanvas.GridWidth-(u+0.5*v+0.5)*gridToCanvas.uDim,y:gridToCanvas.yOffset+(v*0.75+0.5)*gridToCanvas.vDim};}
gridToCanvas.uSize=8;gridToCanvas.vSize=9;gridToCanvas.uKing=-99;gridToCanvas.vKing=-99;gridToCanvas.tileSize=50;gridToCanvas.xOffset=10;gridToCanvas.yOffset=10;gridToCanvas.uDim=gridToCanvas.tileSize*Math.sqrt(3);gridToCanvas.vDim=gridToCanvas.tileSize*2;gridToCanvas.GridWidth=gridToCanvas.uSize*gridToCanvas.uDim;gridToCanvas.GridHeight=gridToCanvas.vSize*(1.5*(gridToCanvas.tileSize+2));function getHex(tile,radius)
{const cnv=gridToCanvas(tile.u,tile.v);const sz=radius?radius:(gridToCanvas.tileSize+1);let res=[];for(let i=0;i<6;i++)
res.push({x:cnv.x+sz*Math.cos(i*Math.PI/3+Math.PI/2),y:cnv.y+sz*Math.sin(i*Math.PI/3+Math.PI/2)});return res;}
function strokeTile(ctx,style,hex,verts)
{if(!('stroke'in style))return;ctx.beginPath();ctx.lineCap='round';ctx.lineJoin='round';ctx.strokeStyle=style.stroke;ctx.setLineDash((typeof style.dash==='undefined')?[]:style.dash);ctx.lineWidth=('lineWidth'in style)?style.lineWidth:1;ctx.moveTo(hex[verts[0]].x,hex[verts[0]].y);for(let i=1;i<verts.length;i++)
ctx.lineTo(hex[verts[i]].x,hex[verts[i]].y);ctx.stroke();}
function renderTile(tile,ctx)
{let style=renderTile.styles[tile.type];if(!style)
{console.warn('No render style for tile',tile);return;}
const cnv=gridToCanvas(tile.u,tile.v);const sz=gridToCanvas.tileSize+1;ctx.beginPath()
ctx.strokeStyle='transparent';ctx.setLineDash([]);ctx.fillStyle=style.fill;let hex=getHex(tile);ctx.moveTo(hex[0].x,hex[0].y);for(let i=1;i<6;i++)
ctx.lineTo(hex[i].x,hex[i].y);ctx.closePath();ctx.fill();if(tile.perilcard)
{if(tile.perilcard.slice(0,2)==='PP')
{let minihex=getHex(tile,gridToCanvas.tileSize-renderTile.styles.KingsPalace.lineWidth/2);switch(tile.perilcard[2])
{case'N':strokeTile(ctx,style,minihex,[1,2,3,4,5]);break;case'S':strokeTile(ctx,style,minihex,[4,5,0,1,2]);break;case'E':strokeTile(ctx,style,minihex,[3,4,5,0]);break;case'W':strokeTile(ctx,style,minihex,[0,1,2,3]);break;}}
else
{let pattern=ctx.createRadialGradient(cnv.x,cnv.y,0,cnv.x,cnv.y,gridToCanvas.tileSize);pattern.addColorStop(0.55,'transparent');pattern.addColorStop(0.75,'black');pattern.addColorStop(0.85,'transparent');ctx.fillStyle=pattern;ctx.beginPath();ctx.arc(cnv.x,cnv.y,gridToCanvas.tileSize,0,2*Math.PI);ctx.fill();}}}
renderTile.styles={ClanCastle:{fill:'dimgray'},KingsPalace:{fill:'royalblue',stroke:'white',lineWidth:5},KingTile:{fill:'transparent'},Plains:{fill:'forestgreen'},Forest:{fill:'darkgreen'},Swamp:{fill:'saddlebrown'},Mountains:{fill:'paleturquoise'},StoneCircle:{fill:'darkturquoise'},Dungeon:{fill:'purple'},Settlement:{fill:'slategray'},};function renderTileEffects(tile,ctx,entities)
{const hex=getHex(tile);if(tile.type==='ClanCastle')
{const cnv=gridToCanvas(tile.u,tile.v);let r=Math.trunc(gridToCanvas.tileSize*renderTileEffects.effects.clancastle.radius);ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=renderTileEffects.effects.clancastle.text;ctx.font=r.toString()+'px Arial';ctx.fillText(tile.state.player.toString(),cnv.x,cnv.y);}
else if(tile.state.terrorized)
{ctx.strokeStyle=renderTileEffects.effects.terrorized.stroke;ctx.setLineDash([]);ctx.lineCap='round';ctx.lineJoin='round';ctx.lineWidth=renderTileEffects.effects.terrorized.lineWidth;ctx.beginPath();for(let i=0;i<3;i++)
{ctx.moveTo(hex[i].x,hex[i].y);ctx.lineTo(hex[i+3].x,hex[i+3].y);}
ctx.stroke();}
else if(tile.state.owner)
{let owner=entities.getLivingEntity('id',tile.state.owner,false);if(owner&&(owner instanceof Hero))
{const cnv=gridToCanvas(tile.u,tile.v);const sz=gridToCanvas.tileSize*renderTileEffects.effects.owner.radius;let pattern=ctx.createRadialGradient(cnv.x,cnv.y,0,cnv.x,cnv.y,sz);let fill=renderEntity.styles[owner.type.slice(0,-2)].fill;pattern.addColorStop(0,fill);pattern.addColorStop(0.4,fill);pattern.addColorStop(1,renderTile.styles.Settlement.fill);ctx.fillStyle=pattern;let smallhex=getHex(tile,sz);ctx.beginPath();ctx.moveTo(smallhex[0].x,smallhex[0].y);for(let i=1;i<6;i++)
ctx.lineTo(smallhex[i].x,smallhex[i].y);ctx.closePath();ctx.fill();}}
if(tile.state.fortified)
{let smallhex=getHex(tile,gridToCanvas.tileSize-renderTileEffects.effects.fortified.lineWidth/2);strokeTile(ctx,renderTileEffects.effects.fortified,smallhex,[0,1,2,3,4,5,0]);}
if(tile.hasEffect('TRK46'))
{let smallhex=getHex(tile,gridToCanvas.tileSize-renderTileEffects.effects.walls.lineWidth/2);strokeTile(ctx,renderTileEffects.effects.walls,smallhex,[0,1,2,3,4,5,0]);}
if(tile.hasEffect('TRK37'))
{let smallhex=getHex(tile,gridToCanvas.tileSize-renderTileEffects.effects.spiritwalls.radius);for(let i=0;i<6;i++)
{let pattern=ctx.createRadialGradient(smallhex[i].x,smallhex[i].y,0,smallhex[i].x,smallhex[i].y,renderTileEffects.effects.spiritwalls.radius);pattern.addColorStop(0,renderTileEffects.effects.spiritwalls.colora);pattern.addColorStop(1,renderTileEffects.effects.spiritwalls.colorb);ctx.fillStyle=pattern;ctx.beginPath();ctx.arc(smallhex[i].x,smallhex[i].y,renderTileEffects.effects.spiritwalls.radius,0,2*Math.PI);ctx.fill();}}
if(tile.hasEffect('TRK38')||tile.hasEffect('TRK39')||tile.hasEffect('TRK44')||tile.hasEffect('TRK45'))
{const cnv=gridToCanvas(tile.u,tile.v);let r=Math.trunc(gridToCanvas.tileSize*renderTileEffects.effects.trader.radius);ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=renderTileEffects.effects.trader.text;ctx.font=r.toString()+'px Armello Icons';ctx.fillText('G',cnv.x,cnv.y);}
else if(tile.hasEffect('TRK38PRE')||tile.hasEffect('TRK39PRE')||tile.hasEffect('TRK44PRE')||tile.hasEffect('TRK45PRE'))
{const cnv=gridToCanvas(tile.u,tile.v);let r=Math.trunc(gridToCanvas.tileSize*renderTileEffects.effects.incomingtrader.radius);ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=renderTileEffects.effects.incomingtrader.text;ctx.font=r.toString()+'px Armello Icons';ctx.fillText('G',cnv.x,cnv.y);}
else if(tile.hasEffect('TRK13'))
{const cnv=gridToCanvas(tile.u,tile.v);let r=Math.trunc(gridToCanvas.tileSize*renderTileEffects.effects.industry.radius);ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=renderTileEffects.effects.industry.text;ctx.font=r.toString()+'px Armello Icons';ctx.fillText('P',cnv.x,cnv.y);}
if(tile.hasEffect('MAG30'))
{let smallhex=getHex(tile,gridToCanvas.tileSize-renderTileEffects.effects.thorns.lineWidth);let minihex=getHex(tile,gridToCanvas.tileSize*0.8);ctx.lineCap='round';ctx.lineJoin='round';ctx.lineWidth=renderTileEffects.effects.thorns.lineWidth;ctx.strokeStyle=renderTileEffects.effects.thorns.stroke;ctx.setLineDash([]);ctx.beginPath();ctx.moveTo(minihex[5].x,minihex[5].y);for(let i=0;i<6;i++)
ctx.lineTo(minihex[i].x,minihex[i].y);for(let i=0;i<6;i++)
{ctx.moveTo(minihex[i].x,minihex[i].y);ctx.lineTo(smallhex[i].x,smallhex[i].y);}
ctx.stroke();}
if(tile.hasEffect('MAG46'))
{let hex=getHex(tile,gridToCanvas.tileSize*renderTileEffects.effects.fog.radius);ctx.fillStyle=renderTileEffects.effects.fog.fill;ctx.beginPath();ctx.moveTo(hex[0].x,hex[0].y);for(let i=1;i<6;i++)
ctx.lineTo(hex[i].x,hex[i].y);ctx.closePath();ctx.fill();}}
renderTileEffects.effects={clancastle:{text:'rgba(128,128,64,0.5)',radius:1.0},owner:{radius:0.6},terrorized:{stroke:'black',lineWidth:5},fortified:{stroke:'white',lineWidth:5},walls:{stroke:'white',lineWidth:3},spiritwalls:{colora:'blue',colorb:'cyan',radius:6},industry:{text:'white',radius:0.5},incomingtrader:{text:'black',radius:0.5},trader:{text:'white',radius:0.5},thorns:{stroke:'rgba(0,64,0,1.0)',lineWidth:5},fog:{fill:'rgba(64,64,0,0.7)',radius:1.0},};function renderEntity(entity,ctx)
{let type=(entity instanceof Hero)?entity.type.slice(0,-2):entity.type;let style=renderEntity.styles[type];if(!style)
{console.warn('No render style for entity',entity);return;}
let cnv=gridToCanvas(entity.u,entity.v);let r=gridToCanvas.tileSize*style.size;ctx.beginPath();ctx.arc(cnv.x,cnv.y,r,0,2*Math.PI);if(entity instanceof Illusion)
{let original=renderEntity.styles[entity.original.slice(0,-2)];ctx.fillStyle=original.fill;}
else
ctx.fillStyle=style.fill;ctx.strokeStyle=style.stroke;ctx.setLineDash((typeof style.dash==='undefined')?[]:style.dash);ctx.lineWidth=style.lineWidth;ctx.fill();ctx.stroke();let text;if(entity instanceof Hero)text=entity.playerid;else if(entity instanceof Illusion)text=entity.playerid;else if(entity.type==='King')text='K';else if(entity.type==='KingsGuard')text='G';else if(entity.type==='Bane')text='B';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=style.text;ctx.font=r.toString()+'px Arial';ctx.fillText(text,cnv.x,cnv.y);}
renderEntity.styles={King:{size:0.5,fill:'blue',stroke:'darkgoldenrod',lineWidth:4,'text':'yellow'},KingsGuard:{size:0.5,fill:'blue',stroke:'darkgoldenrod',lineWidth:4,'text':'yellow'},Bane:{size:0.5,fill:'darkviolet',stroke:'indigo',lineWidth:4,'text':'fuchsia'},Bandit:{size:0.5,fill:'#333333',stroke:'gold',lineWidth:4,'text':'gold'},Bear:{size:0.5,fill:'#006006',stroke:'gold',lineWidth:4,'text':'gold'},Rabbit:{size:0.5,fill:'#9F7714',stroke:'gold',lineWidth:4,'text':'gold'},Rat:{size:0.5,fill:'#9A2D36',stroke:'gold',lineWidth:4,'text':'gold'},Wolf:{size:0.5,fill:'#3674A3',stroke:'gold',lineWidth:4,'text':'gold'},Dragon:{size:0.5,fill:'#824098',stroke:'gold',lineWidth:4,'text':'gold'},Illusion:{size:0.5,stroke:'gold',lineWidth:4,'text':'gold','dash':[10,10]},};function renderMarker(marker,context,ctx)
{switch(marker.type)
{case'quest':renderQuestMarker(marker,context,ctx);break;case'stone':renderStoneMarker(marker,ctx);break;case'banespawn':renderBaneSpawnMarker(marker,ctx);break;case'stonespawn':renderStoneSpawnMarker(marker,ctx);break;}}
function renderBaneSpawnMarker(marker,ctx)
{let cnv=gridToCanvas(marker.u,marker.v);let r=gridToCanvas.tileSize*0.25;ctx.beginPath();ctx.moveTo(cnv.x-r,cnv.y-r);ctx.lineTo(cnv.x+r,cnv.y+r);ctx.moveTo(cnv.x-r,cnv.y+r);ctx.lineTo(cnv.x+r,cnv.y-r);ctx.strokeStyle='fuchsia';ctx.setLineDash([]);ctx.lineWidth=8;ctx.lineCap='round';ctx.stroke();}
function renderStoneSpawnMarker(marker,ctx)
{let cnv=gridToCanvas(marker.u,marker.v);let r=gridToCanvas.tileSize*0.25;let pattern=ctx.createRadialGradient(cnv.x,cnv.y,0,cnv.x,cnv.y,r);pattern.addColorStop(0,'cyan');pattern.addColorStop(1,'blue');ctx.beginPath();ctx.moveTo(cnv.x-r,cnv.y-r);ctx.lineTo(cnv.x+r,cnv.y+r);ctx.moveTo(cnv.x-r,cnv.y+r);ctx.lineTo(cnv.x+r,cnv.y-r);ctx.strokeStyle=pattern;ctx.setLineDash([]);ctx.lineWidth=8;ctx.lineCap='round';ctx.stroke();}
function renderStoneMarker(marker,ctx)
{let cnv=gridToCanvas(marker.u,marker.v);let r=gridToCanvas.tileSize*0.4;let pattern=ctx.createRadialGradient(cnv.x,cnv.y,0,cnv.x,cnv.y,r);pattern.addColorStop(0,'cyan');pattern.addColorStop(1,'blue');ctx.fillStyle=pattern;ctx.beginPath();ctx.arc(cnv.x,cnv.y,r,0,2*Math.PI);ctx.fill();}
function renderQuestMarker(marker,context,ctx)
{let hero=context.entities.getItemById('playerid',marker.player).type;let style=renderQuestMarker.styles[hero.slice(0,-2)];let cnv=gridToCanvas(marker.u,marker.v);let r=gridToCanvas.tileSize*style.size;ctx.beginPath();ctx.moveTo(cnv.x,cnv.y-r);ctx.lineTo(cnv.x+r,cnv.y);ctx.lineTo(cnv.x,cnv.y+r);ctx.lineTo(cnv.x-r,cnv.y);ctx.closePath();ctx.fillStyle=style.fill;ctx.strokeStyle=style.stroke;ctx.setLineDash([]);ctx.lineWidth=style.lineWidth;ctx.fill();ctx.stroke();ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillStyle=style.text;ctx.font=r.toString()+'px Arial';ctx.fillText(marker.player.toString(),cnv.x,cnv.y);}
renderQuestMarker.styles={Bandit:{size:0.7,fill:'#333333',stroke:'gold',lineWidth:2,'text':'gold'},Bear:{size:0.7,fill:'#006006',stroke:'gold',lineWidth:2,'text':'gold'},Rabbit:{size:0.7,fill:'#9F7714',stroke:'gold',lineWidth:2,'text':'gold'},Rat:{size:0.7,fill:'#9A2D36',stroke:'gold',lineWidth:2,'text':'gold'},Wolf:{size:0.7,fill:'#3674A3',stroke:'gold',lineWidth:2,'text':'gold'},Dragon:{size:0.7,fill:'#824098',stroke:'gold',lineWidth:2,'text':'gold'},};function getItemAt(collection,x,y,rate,filterfunc)
{if(collection.items.length==0)return undefined;let idx=-1;let item;let coords;let dsqr=parseFloat("Infinity");for(let i=0;i<collection.items.length;i++)
if((typeof filterfunc!=='function')||filterfunc(collection.items[i]))
{item=collection.items[i];coords=gridToCanvas(item.u,item.v);dcurrent=(coords.x-x)*(coords.x-x)+(coords.y-y)*(coords.y-y);if(dcurrent<dsqr)
{idx=i;dsqr=dcurrent;}}
if(dsqr<=(gridToCanvas.tileSize*gridToCanvas.tileSize*rate*rate))
return{item:collection.items[idx],dist:dsqr};else
return undefined;}</script>
	<script>function sanitize(s)
{return s.replace(/[&<>]/g,function(tag){return sanitize.tagsToReplace[tag]||tag;});}
sanitize.tagsToReplace={'&':'&amp;','<':'&lt;','>':'&gt;'};function describeEntity(entity)
{if(!(entity instanceof Entity))
entity=window.ArmelloMatchState.entities.getItemById('id',entity);return'<span class="entity" data-id="'+entity.id+'">'+Name(entity.type)+'</span>';}
function describeTile(tile)
{let coords;if(!(tile instanceof MapTile))
{coords=tile;tile=window.ArmelloMatchState.map.getItemById('coords',tile,false);}
if(tile)
return'<span class="tile" data-id="'+tile.coords+'">'+Name(tile.type)+' at '+tile.coords+'</span>';else
return'<span class="tile" data-id="'+coords+'">'+coords+'</span>';}
function describeRoll(roll)
{return'<span class="roll roll-'+roll.type+' roll-'+roll.source+'" title="'+roll.source+' '+roll.type+'">'+describeRoll.dicemap[roll.symbol]+'</span>';}
describeRoll.dicemap={Sword:'x',Shield:'u',Sun:'o',Moon:'c',WyldTree:'y',Rot:'q'};function describeEvent(evt)
{let context=window.ArmelloMatchState;switch(evt.name)
{case'spawnNPC':if(evt.type=='Bane')return Name(evt.type)+' spawns at '+describeTile(evt.coords);break;case'spawnSpiritStone':return'Spirit stone spawns at '+describeTile(evt.coords);break;case'moveEntity':return describeEntity(evt.entity)+' moves to '+describeTile(evt.coords)+'.';break;case'attack':return describeEntity(evt.attacker)+' attacks '+describeEntity(evt.defender)+'!';break;case'combatEnd':{let a=describeEntity(evt.attacker);let d=describeEntity(evt.defender);let text;switch(evt.outcome)
{case'Attacking-Lose':text=d+' defends against '+a+'.';break;case'Defending-PushedBack':text=a+' forces '+d+' to retreat.';break;case'Attacking-Defeat':text=d+' kills '+a+'.';break;case'Defending-Defeat':text=a+' kills '+d+'.';break;case'Defending-Routed':text=a+' drives '+d+' before them.';break;case'Attacking-BothDead':text=a+' and '+d+' kill each other.';break;default:text=a+' and '+d+' fight each other.';break;};let adice=evt.attacker_dice.parts.map(function(p){return(p.value>0?'+':'')+p.value.toString()}).join('').slice(1);let ddice=evt.defender_dice.parts.map(function(p){return(p.value>0?'+':'')+p.value.toString()}).join('').slice(1);let ahits=evt.attacker_dice.rolls.filter(function(r){return r.type=='Hit'||r.type=='Pierce'||r.type=='Poison';});let ablocks=evt.attacker_dice.rolls.filter(function(r){return r.type=='Block'||r.type=='Reflect';});ahits.reverse();ablocks.reverse();let dhits=evt.defender_dice.rolls.filter(function(r){return r.type=='Hit'||r.type=='Pierce'||r.type=='Poison';});let dblocks=evt.defender_dice.rolls.filter(function(r){return r.type=='Block'||r.type=='Reflect';});text+='<table class="roll-tooltip"><tr>';text+='<td class="attacker-name">'+a+'</td>';text+='<td class="defender-name">'+d+'</td>';text+='</tr><tr>'
text+='<td class="attacker">'+adice+'='+evt.attacker_dice.parts.reduce(function(a,b){return a+b.value;},0)+' dice</td>';text+='<td class="defender">'+ddice+'='+evt.defender_dice.parts.reduce(function(a,b){return a+b.value;},0)+' dice</td>';text+='</tr><tr>'
text+='<td class="attacker-dice">'+ahits.map(describeRoll).join('')+'</td>';text+='<td class="defender-dice">'+dhits.map(describeRoll).join('')+'</td>';text+='</tr><tr>'
text+='<td class="attacker-dice">'+ablocks.map(describeRoll).join('')+'</td>';text+='<td class="defender-dice">'+dblocks.map(describeRoll).join('')+'</td>';text+='</tr></table>';return text;};break;case'killEntity':{let ent=context.entities.getItemById('id',evt.entity);if(ent instanceof Hero)
return describeEntity(ent)+' returns to the Clan Grounds.';else
return describeEntity(ent)+' dies.';};break;case'equipCard':{let ent=context.entities.getItemById('id',evt.entity);if(ent instanceof Hero)
return describeEntity(ent)+(evt.card.slice(0,3)=='FOL'?' recruits ':' equips ')+PCard(evt.card)+'.';else
return undefined;};break;case'unequipCard':{let ent=context.entities.getItemById('id',evt.entity);if(!(ent instanceof Hero))return;switch(evt.reason)
{case'Discarded':return describeEntity(ent)+' discards '+PCard(evt.card)+'.';break;case'Stolen':return describeEntity(ent)+' has their '+PCard(evt.card)+' stolen from them!';break;case'Fickle':return PCard(evt.card)+' leaves '+describeEntity(ent)+'.';break;default:return describeEntity(ent)+' loses '+PCard(evt.card)+'.';break;}};break;case'gainCard':return describeEntity(context.players.getItemById('id',evt.player).hero)+' gets "'+PCard(evt.card)+'".';break;case'loseCard':return describeEntity(context.players.getItemById('id',evt.player).hero)+' loses "'+PCard(evt.card)+'" from their hand.';break;case'playCardOnCreature':{let ent1=context.entities.getItemById('playerid',evt.player);let ent2=context.entities.getItemById('id',evt.entity);return describeEntity(ent1)+' plays '+PCard(evt.card)+' on '+describeEntity(ent2);};break;case'playCardOnTile':{let entity=evt.entity?context.entities.getItemById('id',evt.entity):context.entities.getItemById('playerid',evt.player);return describeEntity(entity)+' plays '+PCard(evt.card)+' on '+describeTile(evt.coords);};break;case'changeStats':{let ent=context.entities.getItemById('id',evt.entity);if(ent.type&&(evt.stat in ent))
{if((evt.stat==='Health')&&(ent.Health==0))
return describeEntity(ent)+(evt.delta>0?' gains ':' loses ')+Math.abs(evt.delta).toString()+' '+evt.stat+' and dies.';else
return describeEntity(ent)+(evt.delta>0?' gains ':' loses ')+Math.abs(evt.delta).toString()+' '+evt.stat+'.';}
else
return undefined;};break;case'bountyChanged':{let ent=context.entities.getItemById('id',evt.entity);let desc=describeEntity(ent);switch(evt.value)
{case 1:return'There is a bounty on '+desc+"'s head!";break;case 2:return desc+" has been declared a Fugitive!";break;case 3:return desc+" has been declared a Traitor!";break;default:return'There is no longer a bounty on '+desc+"'s head.";break;}};break;case'putPeril':{let ent=(evt.owner<5)?context.entities.getItemById('playerid',evt.owner):context.entities.getItemById('id',evt.owner);return describeEntity(ent)+' puts '+PCard(evt.card)+' at '+describeTile(evt.coords)+'.';};break;case'encounterPeril':{let tile=context.map.getItemById('coords',evt.coords);let hero=context.entities.getItemById('id',evt.entity);return describeEntity(hero)+' encounters '+PCard(tile.perilcard)+' at '+describeTile(evt.coords)+'.';};break;case'completePeril':{let tile=context.map.getItemById('coords',evt.coords);let hero=context.entities.getItemById('id',evt.entity);let heroname=describeEntity(hero);let owner=context.entities.getItemById('id',tile.perilowner);let outcome=(evt.result=='Win')?' has passed ':' has failed ';let dice=evt.dice.parts.map(function(p){return(p.value>0?'+':'')+p.value.toString()}).join('').slice(1);let rolls=evt.dice.rolls;let text=heroname+outcome+describeEntity(owner)+"'s "+PCard(tile.perilcard)+' at '+describeTile(evt.coords)+'.';text+='<table class="roll-tooltip"><tr>';text+='<td class="attacker-name">'+heroname+'</td>';text+='</tr><tr>'
text+='<td class="attacker">'+dice+'='+evt.dice.parts.reduce(function(a,b){return a+b.value;},0)+' dice</td>';text+='</tr><tr>'
text+='<td class="defender-dice">'+rolls.map(describeRoll).join('')+'</td>';text+='</tr></table>';return text;};break;case"settlementChangeOwner":{let entity;if(evt.reason.slice(0,3)=='TRK')
entity=evt.entity?context.entities.getItemById('id',evt.entity):context.entities.getItemById('playerid',evt.player);else
entity=context.entities.getLivingEntity('coords',evt.coords,false);switch(evt.reason)
{case'KingsDec':return describeTile(evt.coords)+' has revolted.';break;case'BaneTerrorise':case'KingsGuardTerrorise':case'TRK16':return describeTile(evt.coords)+' has been terrorized by '+describeEntity(entity)+'.';break;default:if(evt.type=='SettlementCaptured')
{if(entity)
return describeTile(evt.coords)+' has been captured by '+describeEntity(entity)+'.';else
return describeTile(evt.coords)+' has been pacified.';};break;}};break;case"settlementFortified":{let tile=context.map.getItemById('coords',evt.coords);if(evt.entity)
{let entity=context.entities.getItemById('id',evt.entity);return describeEntity(entity)+' has fortified '+describeTile(tile);}
else
return describeTile(tile)+' has been fortified.';};break;case'completeQuest':return describeEntity(context.context.active)+' has completed a quest.';break;case'prestigeLeader':return describeEntity(context.players.getItemById('id',evt.player).hero)+' is now prestige leader!';break;case'declaration':return'Declaration "'+PDecl(evt.type)+'" is now in effect!';break;case'playerQuit':{let pl=context.players.getItemById('id',evt.player);let s=sanitize(pl.name);switch(evt.reason)
{case'PeerLeftRoom':s+=' has quit the game.';break;case'PeerKickedAFK':s+=' has been kicked for being AFK.';break;default:s+=' disconnected.';}
return s;};break;case'startTurn':{let entity=evt.entity?context.entities.getItemById('id',evt.entity):context.entities.getItemById('playerid',evt.player);return"It's now "+describeEntity(entity)+"'s turn.";};break;case'nextRound':return((context.context.round%2==0)?'Day ':'Night ')+(Math.floor(context.context.round/2)+1).toString();break;case'victory':return sanitize(context.players.getItemById('id',evt.player).name)+' wins the game!';break;case'chat':{if(evt.message)
{let s=evt.message.replace(/\[url="herotooltip:\/\/(\w+?)"\].+?\[\/url\]|\[.+?\]/ig,function(a,b)
{if(b)
return describeEntity(context.entities.getItemById('type',b));else
return'';});return describeEntity(context.players.getItemById('id',evt.player).hero)+' ['+evt.type+']: '+s;}
else if(evt.target)
return describeEntity(context.players.getItemById('id',evt.player).hero)+': '+evt.type+' '+describeEntity(context.players.getItemById('id',evt.target).hero);else
return describeEntity(context.players.getItemById('id',evt.player).hero)+': '+evt.type;};break;default:return undefined;break;}}
describeEvent.eventpairs={attack:"combatEnd",encounterPeril:"completePeril",};function updateHeroFor(player)
{let id=player.id;let hero=player.hero;if(!hero)return;document.querySelector('#players .info[data-player-id="'+id+'"] .hero').innerHTML=' as '+Name(hero.type);let cell=document.querySelector('#players .player[data-player-id="'+id+'"]');cell.setAttribute('data-clan',hero.type.slice(0,-2));for(let i=0;i<3;i++)
{let item=cell.querySelector('.equipped .items[data-index="'+i.toString()+'"]');item.innerHTML=hero.equipment[i]?PCard(hero.equipment[i]):'-';let follower=cell.querySelector('.equipped .followers[data-index="'+i.toString()+'"]');follower.innerHTML=hero.followers[i]?PCard(hero.followers[i]):'-';}
let stats=cell.querySelectorAll('.stats *[data-stat]');for(let i=0;i<stats.length;i++)
{let stat=stats[i].getAttribute('data-stat');if(stat in hero)
stats[i].innerHTML=hero[stat].toString();}
let eff=hero.effects.filter(function(val)
{return(val!=='TRK_DISCOUNT')&&(val!=='DEFAULT_STEALTH')&&(val.slice(0,3)!=='CLN')&&(val.slice(0,3)!=='POW')&&(hero.equipment.indexOf(val)<0)&&(hero.followers.indexOf(val)<0);});let effects=eff.map(PCard).join('; ');let pacts=window.ArmelloMatchState.context.pacts.filter(function(p){return(p.initiator==id)||(p.recipient==id);});for(let i=pacts.length-1;i>=0;i--)
{let s=PCard(pacts[i].type);if(pacts[i].initiator==id)
s+='(to '+Name(window.ArmelloMatchState.players.getItemById('id',pacts[i].recipient).hero.type)+'); ';else
s+='(from '+Name(window.ArmelloMatchState.players.getItemById('id',pacts[i].initiator).hero.type)+'); ';effects=s+effects;}
cell.querySelector('.effects').innerHTML=effects;cell.querySelector('.hand').innerHTML=player.hand.map(Name).join('; ');let caption=document.querySelector('#players .info[data-player-id="'+id+'"]');if(player.hasquit)
caption.setAttribute('data-quit','true');else
caption.removeAttribute('data-quit');if(hero.SpiritStones>=4)
caption.setAttribute('data-spirit-walker','true');else
caption.removeAttribute('data-spirit-walker');let king=window.ArmelloMatchState.entities.getItemById('type','King');if(hero.Rot>king.Rot)
caption.setAttribute('data-rotten','true');else
caption.removeAttribute('data-rotten');let bounty=hero.getBounty();if(bounty>0)
caption.setAttribute('data-bounty',bounty.toString());else
caption.removeAttribute('data-bounty');}
function ContextChanged(context,propname,action,value)
{if(propname=='prestige_leader')
for(let i=0;i<window.ArmelloMatchState.players.items.length;i++)
{let id=window.ArmelloMatchState.players.items[i].id;let caption=document.querySelector('#players .info[data-player-id="'+id+'"]');if(context.prestige_leader==id)
caption.setAttribute('data-prestige-leader','true');else
caption.removeAttribute('data-prestige-leader');}
else if(propname=='pacts')
for(let i=0;i<window.ArmelloMatchState.players.items.length;i++)
updateHeroFor(window.ArmelloMatchState.players.items[i]);}
function PlayersChanged(players,propname,propaction,player)
{if((propaction==='change')&&(typeof player==='undefined'))
{for(let id=1;id<=4;id++)
{let plr=players.getItemById('id',id);let caption=document.querySelector('#players .info[data-player-id="'+id+'"] a');caption.parentNode.setAttribute('data-clan',plr.hero.type.slice(0,-2))
caption.innerHTML='['+id.toString()+'] '+sanitize(plr.name);caption.setAttribute('href','https://steamcommunity.com/profiles/'+plr.steam);updateHeroFor(plr);}}
else
updateHeroFor(player);}
function OnUpdate(context,prop,action,value)
{if((prop=='players')||(prop=='entities')||(prop=='map')||(prop=='markers'))
renderMap(document.getElementById('map'),context);}
function jumpToEvent(eventid,scrollto)
{let target=document.querySelector('#turns *[data-event-index="'+eventid+'"]');if(!target)return false;if(!target.hasAttribute('selected'))
{let current=document.querySelector('#turns *[selected]');let currenteventidx=current?parseInt(current.getAttribute('data-event-index'),10):-1;let selectedeventidx=parseInt(eventid,10);let snapshotidx=window.ArmelloMatchEvents[selectedeventidx].snapshot_index;let starteventidx=selectedeventidx;while(window.ArmelloMatchEvents[starteventidx].snapshot_index==snapshotidx)
starteventidx--;if((starteventidx>currenteventidx)||(selectedeventidx<currenteventidx))
window.ArmelloMatchState.loadSnapshot(window.ArmelloMatchSnapshots[snapshotidx]);else
starteventidx=currenteventidx;for(let i=starteventidx+1;i<=selectedeventidx;i++)
window.ArmelloMatchState.processEvent(window.ArmelloMatchEvents[i]);if(current)current.removeAttribute('selected');target.setAttribute('selected','true');if(scrollto)
target.scrollIntoView(true);}
window.location.hash=target.getAttribute('data-event-index');return true;}
function HashChanged(evt)
{if(window.location.hash!=='')
{evt.preventDefault();jumpToEvent(window.location.hash.slice(1),true);}}
function EventClicked(evt)
{let target=evt.target;while(!target.hasAttribute('data-event-index')&&(target.id!=='turns'))
target=target.parentNode;if((target.id==='turns')||target.hasAttribute('selected'))return;evt.preventDefault();jumpToEvent(target.getAttribute('data-event-index'),false);}
function PrevEvent(evt)
{let current=document.querySelector('#turns *[selected]');if(current.previousElementSibling)
jumpToEvent(current.previousElementSibling.getAttribute('data-event-index'),true);}
function NextEvent()
{let current=document.querySelector('#turns *[selected]');if(current.nextElementSibling)
jumpToEvent(current.nextElementSibling.getAttribute('data-event-index'),true);}
function PrevTurn()
{let current=document.querySelector('#turns *[selected]');let matcher=/\bevent-startTurn\b/i;let target=current.previousElementSibling;while(target&&!matcher.test(target.className))
target=target.previousElementSibling;if(target)
jumpToEvent(target.getAttribute('data-event-index'),true);}
function NextTurn()
{let current=document.querySelector('#turns *[selected]');let matcher=/\bevent-startTurn\b/i;let target=current.nextElementSibling;while(target&&!matcher.test(target.className))
target=target.nextElementSibling;if(target)
jumpToEvent(target.getAttribute('data-event-index'),true);}
function FirstEvent()
{let turns=document.querySelector('#turns');jumpToEvent(turns.firstElementChild.getAttribute('data-event-index'),true);}
function LastEvent()
{let turns=document.querySelector('#turns');jumpToEvent(turns.lastElementChild.getAttribute('data-event-index'),true);}
function EventHover(evt)
{if(/\bentity|tile\b/.test(evt.target.className))
{evt.preventDefault();let target=evt.target.getAttribute('data-id');if(EventHover.target!=target)
{let t=(/\btile\b/.test(evt.target.className))?window.ArmelloMatchState.map.getItemById('coords',target,false):window.ArmelloMatchState.entities.getItemById('id',target,false);renderMap(document.getElementById('map'),window.ArmelloMatchState,t);EventHover.target=target;}}
else if(typeof EventHover.target!=='undefined')
{evt.preventDefault();EventHover.target=undefined;renderMap(document.getElementById('map'),window.ArmelloMatchState,undefined);}}
EventHover.target=undefined;function MapHover(evt)
{let rect=evt.target.getBoundingClientRect();let x=(evt.clientX-rect.left)*parseInt(evt.target.getAttribute('width'),10)/rect.width;let y=(evt.clientY-rect.top)*parseInt(evt.target.getAttribute('height'),10)/rect.height;let rx=window.innerWidth-evt.clientX+5;let by=window.innerHeight-evt.clientY+5;let tooltip=document.getElementById('maptooltip');let entity,marker,tile;if(entity=getItemAt(window.ArmelloMatchState.entities,x,y,0.5,function(ent){return!ent.dead;}))
{if(entity.item instanceof Hero)
tooltip.innerHTML=Name(entity.item.type)+'<br />'+sanitize(window.ArmelloMatchState.players.getItemById('id',entity.item.playerid).name)+'<br /><span class="stat">H</span>'+entity.item.Health.toString()+'<span class="stat">F</span>'+entity.item.Fight.toString();else if(entity.item instanceof Illusion)
tooltip.innerHTML=Name(entity.item.type)+' of '+Name(entity.item.original)+'<br />';else if(entity.item.type==='King')
tooltip.innerHTML=Name(entity.item.type)+'<br /><span class="stat">H</span>'+entity.item.Health.toString()+'<span class="stat">R</span>'+entity.item.Rot.toString();else if(entity.item.type==='KingsGuard')
tooltip.innerHTML=Name(entity.item.type)+'<br /><span class="stat">H</span>'+entity.item.Health.toString()+'<span class="stat">F</span>'+entity.item.Fight.toString();else if(entity.item.type==='Bane')
tooltip.innerHTML=Name(entity.item.type)+'<br /><span class="stat">H</span>'+entity.item.Health.toString()+'<span class="stat">F</span>'+entity.item.Fight.toString()+'<span class="stat">R</span>'+entity.item.Rot.toString();else
tooltip.innerHTML=Name(entity.item.type);tooltip.style='visibility:visible; right:'+rx.toString()+'px; bottom:'+by.toString()+'px';}
else if(marker=getItemAt(window.ArmelloMatchState.markers,x,y,0.7))
{tooltip.innerHTML=marker.item.title;tooltip.style='visibility:visible; right:'+rx.toString()+'px; bottom:'+by.toString()+'px';}
else if(tile=getItemAt(window.ArmelloMatchState.map,x,y,1.0))
{let text=describeTile(tile.item);switch(tile.item.type)
{case'ClanCastle':{let plr=window.ArmelloMatchState.players.getItemById('corner',tile.item.corner,false);if(plr)text+='<br />'+sanitize(plr.name);break;}
case'Settlement':{if(tile.item.state.fortified)
text+='<br />Fortified';if(tile.item.state.terrorized)
text+='<br />Terrorized';else if(tile.item.state.owner)
{let owner=window.ArmelloMatchState.entities.getItemById('id',tile.item.state.owner,false);if(owner)
text+='<br />Owner: '+Name(owner.type);}};break;}
for(let i=0;i<tile.item.effects.length;i++)
text+='<br />'+Name(tile.item.effects[i]);if(tile.item.perilcard)
{let ent=(tile.item.perilowner<5)?window.ArmelloMatchState.players.getItemById('id',tile.item.perilowner).hero:window.ArmelloMatchState.entities.getItemById('id',tile.item.perilowner);text+='<br /><span class="stat">#</span> '+Name(tile.item.perilcard)+'('+Name(ent.type)+')';if(tile.item.perilbuffs.length>0)
text+='<br />'+tile.item.perilbuffs.map(Name).join(', ');}
tooltip.innerHTML=text;tooltip.style='visibility:visible; right:'+rx.toString()+'px; bottom:'+by.toString()+'px';}
else
{tooltip.innerHTML='';tooltip.style='';}}
function MapLeave(evt)
{let tooltip=document.getElementById('maptooltip');tooltip.innerHTML='';tooltip.style='';}
function KeyUp(evt)
{switch(evt.key)
{case'Up':case'ArrowUp':{evt.preventDefault();PrevEvent();};break;case'Down':case'ArrowDown':{evt.preventDefault();NextEvent();};break;case'PageUp':{evt.preventDefault();PrevTurn();};break;case'PageDown':{evt.preventDefault();NextTurn();};break;case'Home':{evt.preventDefault();FirstEvent();};break;case'End':{evt.preventDefault();LastEvent();};break;}}
function deleteIfPresent(selector)
{let nodes=document.querySelectorAll(selector);for(let i=0;i<nodes.length;i++)
nodes[i].parentNode.removeChild(nodes[i]);}
function switchToMainView()
{deleteIfPresent('#load');deleteIfPresent('script[data-loader]');document.getElementById('main').removeAttribute('style');let canvas=document.getElementById('map');canvas.setAttribute('width',gridToCanvas.GridWidth+2*gridToCanvas.xOffset);canvas.setAttribute('height',gridToCanvas.GridHeight+2*gridToCanvas.yOffset);canvas.addEventListener('mousemove',MapHover,false);canvas.addEventListener('mouseleave',MapLeave,false);window.ArmelloMatchState.players.subscribe(PlayersChanged);window.ArmelloMatchState.context.subscribe(ContextChanged);window.ArmelloMatchState.subscribe(OnUpdate);let turns=document.getElementById('turns');turns.addEventListener('click',EventClicked,false);turns.addEventListener('mouseover',EventHover,false);window.addEventListener('hashchange',HashChanged,false);window.addEventListener('keyup',KeyUp,false);}
window.addEventListener('load',function(evt){window.ArmelloMatchState=new MatchState();if(('ArmelloMatchEvents'in window)&&('ArmelloMatchSnapshots'in window))
{switchToMainView();let eventchosen=false;if(window.location.hash!=='')
eventchosen=jumpToEvent(window.location.hash.slice(1),true);if(!eventchosen)
{let current=document.querySelector('#turns *[selected]');if(current&&current.getAttribute('data-event-index'))
{current.removeAttribute('selected');eventchosen=jumpToEvent(current.getAttribute('data-event-index'),true);}}
if(!eventchosen)
{let first=document.querySelector('#turns *[data-event-index]')
jumpToEvent(first.getAttribute('data-event-index'),true);}}
else
{if(window.location.hash)
window.location.hash='';var fproc=new FileProcessor(document.getElementById('dropzone'),LogFileSelected,'#888888','transparent');document.getElementById('log').addEventListener('change',function(evt)
{LogFileSelected(evt.target.files[0],fproc.update);},false);document.getElementById('matches').addEventListener('click',function(evt){if(!evt.target.className.match(/\bloadmatch\b/i)||evt.target.hasAttribute('disabled'))return;var buttons=document.getElementById('load').querySelectorAll('.loadmatch');for(let i=0;i<buttons.length;i++)
buttons[i].setAttribute('disabled','true');MatchSelected(evt.target.dataslice,evt.target.parser,fproc.update);},false);let os;if(/^win/i.test(window.navigator.platform))os='windows';else if(/^Mac/i.test(window.navigator.platform))os='mac';else if(/^Linux/i.test(window.navigator.platform))os='linux';else os='unknown';let logpath=document.getElementById('logpath');switch(os)
{case'windows':logpath.innerHTML='%APPDATA%\\..\\LocalLow\\League of Geeks\\Armello\\logs\\';break;case'linux':logpath.innerHTML='~/.config/unity3d/League of Geeks/Armello/logs/';break;case'mac':logpath.innerHTML='~/Library/Application Support/League of Geeks/Armello/logs/';break;}}},false);</script>
</head>
<body>
	<div id="load">
		<label for="log" id="dropzone">Drop Armello log file here or click to browse</label>
		<input accept=".txt" id="log" name="log" type="file">
		<ul id="matches"></ul>
		<div id="help">
			<h1>Armello Match Replay Tool</h1>
			<p>Using this webapp is easy! Create a replay of your match in just three steps:</p>
			<p>1. Click the rectangle above to browse or drop an Armello log file there. You can find those files in <span id="logpath">your user profile folder</span>.</p>
			<p>2. Let the app scan the log file you provided for the matches you've played. Matches ended with game crashing and ongoing matches will not be shown.</p>
			<p>3. Pick a match to be loaded. Once it's done, the app will show a greatly simplified game board and players data. On the left you will see match timeline. Click on an event to jump to that point of the timeline.</p>
			<p>All log files are processed locally, on your device. No privacy leaks, no traffic costs.</p>
			<p>Once the app loads a match, you can save the resulting page to your device - it will keep the data when you re-open it, and will work offline. Feel free to store, share and publish your replays!</p>
		</div>
	</div>
	<div id="main" style="display:none;">
		<table id="players">
			<tr>
				<td class="info" data-clan="wolf" data-player-id="1">
					<a href="" target="_blank">Player name goes here</a>
					<span class="hero"></span>
					<span class="mark-prestige" title="The hero is the Prestige Leader!">P</span>
					<span class="mark-rot" title="The hero has enough Rot to overcome the King!">R</span>
					<span class="mark-stones" title="The hero has enough Spirit Stones to banish the King!">T</span>
					<span class="mark-bounty1" title="The hero has a Bounty on their head!">1</span>
					<span class="mark-bounty2" title="The hero has been declared Fugitive!">2</span>
					<span class="mark-bounty3" title="The hero has been declared Traitor!">3</span>
				</td>
				<td class="info" data-clan="rabbit" data-player-id="2">
					<a href="" target="_blank">Player name goes here</a>
					<span class="hero"></span>
					<span class="mark-prestige" title="The hero is the Prestige Leader!">P</span>
					<span class="mark-rot" title="The hero has enough Rot to overcome the King!">R</span>
					<span class="mark-stones" title="The hero has enough Spirit Stones to banish the King!">T</span>
					<span class="mark-bounty1" title="The hero has a Bounty on their head!">1</span>
					<span class="mark-bounty2" title="The hero has been declared Fugitive!">2</span>
					<span class="mark-bounty3" title="The hero has been declared Traitor!">3</span>
				</td>
				<td class="info" data-clan="bear" data-player-id="3">
					<a href="" target="_blank">Player name goes here</a>
					<span class="hero"></span>
					<span class="mark-prestige" title="The hero is the Prestige Leader!">P</span>
					<span class="mark-rot" title="The hero has enough Rot to overcome the King!">R</span>
					<span class="mark-stones" title="The hero has enough Spirit Stones to banish the King!">T</span>
					<span class="mark-bounty1" title="The hero has a Bounty on their head!">1</span>
					<span class="mark-bounty2" title="The hero has been declared Fugitive!">2</span>
					<span class="mark-bounty3" title="The hero has been declared Traitor!">3</span>
				</td>
				<td class="info" data-clan="rat" data-player-id="4">
					<a href="" target="_blank">Player name goes here</a>
					<span class="hero"></span>
					<span class="mark-prestige" title="The hero is the Prestige Leader!">P</span>
					<span class="mark-rot" title="The hero has enough Rot to overcome the King!">R</span>
					<span class="mark-stones" title="The hero has enough Spirit Stones to banish the King!">T</span>
					<span class="mark-bounty1" title="The hero has a Bounty on their head!">1</span>
					<span class="mark-bounty2" title="The hero has been declared Fugitive!">2</span>
					<span class="mark-bounty3" title="The hero has been declared Traitor!">3</span>
				</td>
			</tr>
			<tr>
			<td class="player" data-clan="wolf" data-player-id="1">
				<table class="equipped">
					<tr><td class="items" data-index="0">Lionheart Breastplate</td><td class="followers" data-index="0">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="1">Lionheart Breastplate</td><td class="followers" data-index="1">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="2">Lionheart Breastplate</td><td class="followers" data-index="2">Brilliant Fool</td></tr>
				</table>
				<table class="stats">
					<tr><td class="Fight" data-stat="Fight" title="Fight">F</td><td class="Body" data-stat="Body" title="Body">B</td><td class="Wits" data-stat="Wits" title="Wits">W</td><td class="Spirit" data-stat="Spirit" title="Spirit">S</td><td class="Rot" data-stat="Rot" title="Rot">R</td></tr>
					<tr><td class="Prestige" data-stat="Prestige" title="Prestige">P</td><td class="Health" data-stat="Health" title="Health">H</td><td class="Gold" data-stat="Gold" title="Gold">G</td><td class="Magic" data-stat="Magic" title="Magic">M</td><td class="SpiritStones" data-stat="SpiritStones" title="Spirit Stones">Ss</td></tr>
				</table>
				<div class="effects">Effect 1; Effect 2; Effect 3</div>
				<div class="hand">Card 1; Card 2; Card 3</div>
			</td>
			<td class="player" data-clan="rabbit" data-player-id="2">
				<table class="equipped">
					<tr><td class="items" data-index="0">Lionheart Breastplate</td><td class="followers" data-index="0">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="1">Lionheart Breastplate</td><td class="followers" data-index="1">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="2">Lionheart Breastplate</td><td class="followers" data-index="2">Brilliant Fool</td></tr>
				</table>
				<table class="stats">
					<tr><td class="Fight" data-stat="Fight" title="Fight">F</td><td class="Body" data-stat="Body" title="Body">B</td><td class="Wits" data-stat="Wits" title="Wits">W</td><td class="Spirit" data-stat="Spirit" title="Spirit">S</td><td class="Rot" data-stat="Rot" title="Rot">R</td></tr>
					<tr><td class="Prestige" data-stat="Prestige" title="Prestige">P</td><td class="Health" data-stat="Health" title="Health">H</td><td class="Gold" data-stat="Gold" title="Gold">G</td><td class="Magic" data-stat="Magic" title="Magic">M</td><td class="SpiritStones" data-stat="SpiritStones" title="Spirit Stones">Ss</td></tr>
				</table>
				<div class="effects">Effect 1; Effect 2; Effect 3</div>
				<div class="hand">Card 1; Card 2; Card 3</div>
			</td>
			<td class="player" data-clan="bear" data-player-id="3">
				<table class="equipped">
					<tr><td class="items" data-index="0">Lionheart Breastplate</td><td class="followers" data-index="0">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="1">Lionheart Breastplate</td><td class="followers" data-index="1">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="2">Lionheart Breastplate</td><td class="followers" data-index="2">Brilliant Fool</td></tr>
				</table>
				<table class="stats">
					<tr><td class="Fight" data-stat="Fight" title="Fight">F</td><td class="Body" data-stat="Body" title="Body">B</td><td class="Wits" data-stat="Wits" title="Wits">W</td><td class="Spirit" data-stat="Spirit" title="Spirit">S</td><td class="Rot" data-stat="Rot" title="Rot">R</td></tr>
					<tr><td class="Prestige" data-stat="Prestige" title="Prestige">P</td><td class="Health" data-stat="Health" title="Health">H</td><td class="Gold" data-stat="Gold" title="Gold">G</td><td class="Magic" data-stat="Magic" title="Magic">M</td><td class="SpiritStones" data-stat="SpiritStones" title="Spirit Stones">Ss</td></tr>
				</table>
				<div class="effects">Effect 1; Effect 2; Effect 3</div>
				<div class="hand">Card 1; Card 2; Card 1; Card 2; Card 1; Card 2; Card 1; Card 2; Card 1; Card 2; Card 1; Card 2; Card 1; Card 2; Card 1; Card 2; Card 3</div>
			</td>
			<td class="player" data-clan="rat" data-player-id="4">
				<table class="equipped">
					<tr><td class="items" data-index="0">Lionheart Breastplate</td><td class="followers" data-index="0">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="1">Lionheart Breastplate</td><td class="followers" data-index="1">Brilliant Fool</td></tr>
					<tr><td class="items" data-index="2">Lionheart Breastplate</td><td class="followers" data-index="2">Brilliant Fool</td></tr>
				</table>
				<table class="stats">
					<tr><td class="Fight" data-stat="Fight" title="Fight">F</td><td class="Body" data-stat="Body" title="Body">B</td><td class="Wits" data-stat="Wits" title="Wits">W</td><td class="Spirit" data-stat="Spirit" title="Spirit">S</td><td class="Rot" data-stat="Rot" title="Rot">R</td></tr>
					<tr><td class="Prestige" data-stat="Prestige" title="Prestige">P</td><td class="Health" data-stat="Health" title="Health">H</td><td class="Gold" data-stat="Gold" title="Gold">G</td><td class="Magic" data-stat="Magic" title="Magic">M</td><td class="SpiritStones" data-stat="SpiritStones" title="Spirit Stones">Ss</td></tr>
				</table>
				<div class="effects">Effect 1; Effect 2; Effect 3</div>
				<div class="hand">Card 1; Card 2; Card 3</div>
			</td>
			</tr>
		</table>
		<div class="lower">
			<ul id="turns"></ul>
			<div class="mapwrapper">
				<canvas id="map">Your browser doesn't support Canvas!</canvas>
				<div id="maptooltip"></div>
			</div>
		</div>
	</div>
</body>
</html>